# תהליך ניהול השותפים

העמוד מאפשר למנהל לצפות בכל השותפים, לבצע חיפוש, לערוך וליצור פרופילים חדשים.

## תהליך טעינת הדף
1. הפונקציה `requireUserSession` בודקת שהמשתמש מחובר ובעל תפקיד מנהל.
2. נקראת פעולה `getPartners` עם פרמטרי דף ברירת מחדל ומחזירה את רשימת השותפים והפאגינציה.
3. הרכיב `PartnerManagement` מקבל את המידע כ־props ומאתחל את המצבים הפנימיים.

## ניהול נתונים וסטטיסטיקות
- המידע מאוחסן במסד MongoDB בטבלאות `users` ו־`partnerprofiles`.
- פעולות הקריאה והכתיבה מבוצעות דרך Mongoose ומאומתות על ידי `requireAdmin`.

## ניהול רשימת השותפים
- `PartnerManagement` שומר במצב את רשימת השותפים, עמוד נוכחי, סך העמודים ומחרוזת החיפוש.
- עם שינוי החיפוש מבוצעת קריאה מחודשת ל־`getPartners` לאחר דיליי קצר.
- ניתן לרענן ידנית או לעבור עמוד באמצעות כפתורי הפאגינציה.

## פעולות CRUD
- **יצירה** – `createPartner` יוצר משתמש חדש ומוסיף רשומת `PartnerProfile`. בסיום מופעל `revalidatePath` לעדכון הדף.
- **עדכון** – `updatePartner` מעדכן את המשתמש הקיים ואת פרטי הפרופיל בהתאם לטופס.
- **מחיקה** – `removePartner` מוחק את הפרופיל ומסיר את המשתמש דרך `deleteUser`.
- **קריאה בודדת** – `getPartnerById` מחזיר פרטי שותף להצגה בדיאלוג.

## ולידציה ואימות
- טופס היצירה/עריכה משתמש ב־Zod להגדרת סכמת שדות וב־React Hook Form לניהול ערכי הטופס.
- לפני כל פעולה נבדק שהמשתמש בעל הרשאת מנהל (`requireAdmin`).

## ניהול מצב ומשוב
- הודעות הצלחה ושגיאה מוצגות באמצעות `useToast`.
- בעת שליחת פעולה `loading` מתעדכן ומחבל בלחצנים.
- דיאלוגים (`PartnerFormDialog`, `PartnerProfileDialog`) נפתחים ונסגרים לפי מצבים פנימיים.
