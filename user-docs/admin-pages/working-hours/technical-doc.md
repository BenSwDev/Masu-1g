# תהליך ניהול השעות

דף "שעות פעילות" מאפשר להגדיר את זמני העבודה של העסק ולחרוג מהם במועדים מיוחדים. להלן פירוט התהליכים העיקריים.

## תהליך טעינת הדף
- בעת כניסה לנתיב מתבצעת `requireUserSession` כדי לוודא שהמשתמש מחובר ומוגדר כמנהל.
- הקומפוננטה `WorkingHoursClient` נטענת בצד הלקוח ומבצעת קריאה ל־`getWorkingHoursSettings` דרך React Query על מנת למשוך את כל ההגדרות הנוכחיות מתוך מסד הנתונים.
- במידה ואין הגדרות קיימות נוצרות הגדרות ברירת מחדל במודל `WorkingHoursSettings`.

## ניהול נתונים וסטטיסטיקות
- הנתונים נשמרים במסמך אחד המורכב משלושה חלקים: `fixedHours` לשעות קבועות של כל ימות השבוע, `specialDates` (לצורך תאימות ישנה) ו־`specialDateEvents` לאירועים מרובי ימים.
- כל שינוי שומר את מועד העדכון (`updatedAt`) ומבצע `revalidatePath` על הדף כדי לוודא שהנתונים מתעדכנים מיידית.

## ניהול רשימת השעות
- בלשונית "שעות קבועות" מוצג טופס בעל שורה לכל יום בשבוע. עבור כל יום ניתן להפעיל/לכבות, להגדיר שעת התחלה וסיום, תוספת מחיר, הערות והגבלות מתקדמות כגון הזמנה מוקדמת מינימלית ושעת ניתוק הזמנות.
- בלשונית "תאריכים מיוחדים" ניתן להוסיף חריגות חד פעמיות עם שדות דומים: שם, תאריך, זמני התחלה וסיום, תוספת מחיר ועוד. ניתן לערוך או למחוק כל תאריך מיוחד.
- בלשונית "אירועים מיוחדים" מנוהלים אירועים המשתרעים על מספר תאריכים, עם שדות נוספים כגון סוג האירוע וצבע להצגה.

## פעולות CRUD
- `updateFixedHours` – שמירת השעות הקבועות עבור כל ימות השבוע.
- `updateSpecialDates` – יצירה או עדכון של רשימת תאריכים מיוחדים.
- `updateSpecialDateEvents` – יצירה או עדכון של אירועים מיוחדים מרובי ימים.
- `deleteSpecialDate` ו־`deleteSpecialDateEvent` – הסרה של רשומה קיימת לפי אינדקס.
- כל פעולה מאמתת הרשאות ומתחברת למסד הנתונים דרך `dbConnect`.

## ולידציה ואימות
- צד הלקוח משתמש ב‑Zod בשילוב React Hook Form לאימות ערכי הטפסים (שעת התחלה/סיום בפורמט תקין, ערכי מספרים חיוביים וכו').
- בצד השרת מתבצעת ולידציה נוספת במודל Mongoose: בדיקה שכל 7 הימים קיימים, מניעת כפילויות בתאריכים ואירועים, ואימות פורמט השעות.

## ניהול מצב ומשוב
- React Query מטפל במצב הטעינה, ההצלחה והשגיאות של כל פעולה.
- במקרים מוצלחים מוצגים toastים בהתאם למחרוזות התרגום (למשל "שעות קבועות עודכנו"). במקרה של שגיאה מוצגת הודעה מסוג "destructive".
- כאשר הפעולה מתבצעת מוצג מצב טעינה בכפתורים ותאי הטבלה מוצגים כ־Skeleton עד לקבלת הנתונים.
