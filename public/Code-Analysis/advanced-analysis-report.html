
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASU Advanced Scenario Analysis</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; margin-top: 10px; }
        .section { background: white; margin: 20px 0; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .flow-item { background: #f8f9fa; margin: 15px 0; padding: 20px; border-radius: 8px; border-right: 4px solid #667eea; }
        .scenario-item { background: #e8f4fd; margin: 10px 0; padding: 15px; border-radius: 5px; border-right: 3px solid #007bff; }
        .user-role { display: inline-block; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 2px; }
        .validation-item { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .error-item { background: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .integration-item { background: #d1ecf1; border: 1px solid #bee5eb; padding: 10px; margin: 5px 0; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; vertical-align: top; }
        th { background: #f8f9fa; font-weight: bold; }
        tr:nth-child(even) { background: #f9f9f9; }
        .collapsible { cursor: pointer; background: #667eea; color: white; padding: 10px; border: none; width: 100%; text-align: right; border-radius: 5px; margin: 5px 0; }
        .collapsible:hover { background: #5a6fd8; }
        .content { display: none; padding: 15px; background: #f9f9f9; border-radius: 5px; margin-bottom: 10px; }
        .content.active { display: block; }
        .sub-scenario { background: white; margin: 8px 0; padding: 12px; border-radius: 4px; border-right: 2px solid #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> MASU Advanced Scenario Analysis</h1>
            <p>转 拽爪 拽爪  砖  转专砖, 转转-转专砖 砖转砖 - 15.6.2025</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">4</div>
                <div class="stat-label">转 拽爪 拽爪</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">27</div>
                <div class="stat-label">转专砖 拽</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">38</div>
                <div class="stat-label">转专砖 爪</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">住注转 砖转砖</div>
            </div>
        </div>

        <div class="section">
            <h2> 转 拽爪 拽爪</h2>
            
                <div class="flow-item">
                    <h3>Booking Process</h3>
                    <p><strong>转驻拽 砖转砖:</strong> <span class="user-role">guest</span><span class="user-role">member</span></p>
                    <p><strong>拽转 专爪:</strong> payment_gateway, sms_service, database</p>
                    
                    <button class="collapsible" onclick="toggleContent(this)">砖 转 (0)</button>
                    <div class="content">
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 拽 (1)</button>
                    <div class="content">
                        
                            <div class="scenario-item">
                                <h4>Booking Process - Happy Path</h4>
                                <p><strong>住:</strong> happy_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">member</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 爪 (0)</button>
                    <div class="content">
                        
                    </div>
                </div>
            
                <div class="flow-item">
                    <h3>Professional Response Process</h3>
                    <p><strong>转驻拽 砖转砖:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                    <p><strong>拽转 专爪:</strong> sms_service, database</p>
                    
                    <button class="collapsible" onclick="toggleContent(this)">砖 转 (3)</button>
                    <div class="content">
                        
                            <div class="sub-scenario">
                                <h4>砖 1: sendProfessionalNotifications</h4>
                                <p><strong>拽抓:</strong> actions\professional-sms-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 8</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (8)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_if_1:</strong> When !booking is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_if_2:</strong> When booking.status !== "confirmed" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_if_3:</strong> When !suitableResult.success || !suitableResult.professionals is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_if_4:</strong> When !professional.userId?.phone is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_if_5:</strong> When smsResult.success is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_else_5:</strong> When smsResult.success is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>sendProfessionalNotifications_error_2:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 2: handleProfessionalResponse</h4>
                                <p><strong>拽抓:</strong> actions\professional-sms-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Israeli phone number validation, Date validation</p>
                                <p><strong>转转-转专砖:</strong> 12</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (12)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_1:</strong> When !response is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_2:</strong> When response.status !== "pending" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_3:</strong> When response.expiresAt < new Date() is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_4:</strong> When !booking || booking.status !== "in_process" || booking.professionalId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_5:</strong> When action === "accept" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_else_5:</strong> When action === "accept" is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_6:</strong> When assignResult.success is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_else_6:</strong> When assignResult.success is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_if_7:</strong> When action === "decline" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_validation_1:</strong> Validate phone: Israeli phone number validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for phone
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_validation_2:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>handleProfessionalResponse_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 3: resendProfessionalNotifications</h4>
                                <p><strong>拽抓:</strong> actions\professional-sms-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 3</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (3)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>resendProfessionalNotifications_if_1:</strong> When !session?.user || session.user.role !== "admin" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>resendProfessionalNotifications_if_2:</strong> When !booking || booking.status !== "confirmed" || booking.professionalId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>resendProfessionalNotifications_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 拽 (5)</button>
                    <div class="content">
                        
                            <div class="scenario-item">
                                <h4>Professional Response Process - Happy Path</h4>
                                <p><strong>住:</strong> happy_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute sendProfessionalNotifications</td>
                                                <td>professional</td>
                                                <td>sendProfessionalNotifications completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>2</td>
                                                <td>Execute handleProfessionalResponse</td>
                                                <td>professional or admin</td>
                                                <td>handleProfessionalResponse completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>3</td>
                                                <td>Execute resendProfessionalNotifications</td>
                                                <td>professional or admin</td>
                                                <td>resendProfessionalNotifications completes successfully</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Professional Response Process - Error at Step 1</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute sendProfessionalNotifications with error condition</td>
                                                <td>professional</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Professional Response Process - Error at Step 1</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute sendProfessionalNotifications with error condition</td>
                                                <td>professional</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Professional Response Process - Error at Step 2</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>2</td>
                                                <td>Execute handleProfessionalResponse with error condition</td>
                                                <td>professional or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Professional Response Process - Error at Step 3</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">professional</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>3</td>
                                                <td>Execute resendProfessionalNotifications with error condition</td>
                                                <td>professional or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 爪 (4)</button>
                    <div class="content">
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Valid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Invalid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                    </div>
                </div>
            
                <div class="flow-item">
                    <h3>Payment Process</h3>
                    <p><strong>转驻拽 砖转砖:</strong> <span class="user-role">guest</span><span class="user-role">member</span></p>
                    <p><strong>拽转 专爪:</strong> payment_gateway, database</p>
                    
                    <button class="collapsible" onclick="toggleContent(this)">砖 转 (4)</button>
                    <div class="content">
                        
                            <div class="sub-scenario">
                                <h4>砖 1: GuestPaymentStep</h4>
                                <p><strong>拽抓:</strong> components\booking\steps\guest-payment-step.tsx</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 9</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (9)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_1:</strong> When isCountingDown && countdown > 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_else_1:</strong> When isCountingDown && countdown > 0 is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_2:</strong> When countdown === 0 && isCountingDown is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_3:</strong> When isCountingDown || !termsAccepted is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_4:</strong> When !pendingBookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_5:</strong> When !bookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_6:</strong> When !calculatedPrice || calculatedPrice.finalAmount === 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_7:</strong> When !pendingBookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_8:</strong> When !bookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 2: anonymous</h4>
                                <p><strong>拽抓:</strong> components\booking\steps\guest-payment-step.tsx</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 0</p>
                                
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 3: GuestPaymentStep</h4>
                                <p><strong>拽抓:</strong> components\booking\steps\guest-payment-step.tsx</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 9</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (9)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_1:</strong> When isCountingDown && countdown > 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_else_1:</strong> When isCountingDown && countdown > 0 is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_2:</strong> When countdown === 0 && isCountingDown is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_3:</strong> When isCountingDown || !termsAccepted is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_4:</strong> When !pendingBookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_5:</strong> When !bookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_6:</strong> When !calculatedPrice || calculatedPrice.finalAmount === 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_7:</strong> When !pendingBookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>GuestPaymentStep_if_8:</strong> When !bookingId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 4: anonymous</h4>
                                <p><strong>拽抓:</strong> components\booking\steps\guest-payment-step.tsx</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 0</p>
                                
                                
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 拽 (1)</button>
                    <div class="content">
                        
                            <div class="scenario-item">
                                <h4>Payment Process - Happy Path</h4>
                                <p><strong>住:</strong> happy_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">member</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute GuestPaymentStep</td>
                                                <td>guest</td>
                                                <td>GuestPaymentStep completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>2</td>
                                                <td>Execute anonymous</td>
                                                <td></td>
                                                <td>anonymous completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>3</td>
                                                <td>Execute GuestPaymentStep</td>
                                                <td>guest</td>
                                                <td>GuestPaymentStep completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>4</td>
                                                <td>Execute anonymous</td>
                                                <td></td>
                                                <td>anonymous completes successfully</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 爪 (0)</button>
                    <div class="content">
                        
                    </div>
                </div>
            
                <div class="flow-item">
                    <h3>Subscription Management</h3>
                    <p><strong>转驻拽 砖转砖:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                    <p><strong>拽转 专爪:</strong> payment_gateway, database</p>
                    
                    <button class="collapsible" onclick="toggleContent(this)">砖 转 (17)</button>
                    <div class="content">
                        
                            <div class="sub-scenario">
                                <h4>砖 1: createSubscription</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>createSubscription_if_1:</strong> When !session?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>createSubscription_if_2:</strong> When error instanceof z.ZodError is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>createSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>createSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 2: updateSubscription</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 5</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (5)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>updateSubscription_if_1:</strong> When !session?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>updateSubscription_if_2:</strong> When !subscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>updateSubscription_if_3:</strong> When error instanceof z.ZodError is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>updateSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>updateSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 3: deleteSubscription</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>deleteSubscription_if_1:</strong> When !session?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteSubscription_if_2:</strong> When !subscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 4: getSubscriptions</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 5</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (5)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptions_if_1:</strong> When options.isActive !== undefined is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptions_if_2:</strong> When options.search is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptions_if_3:</strong> When options.sort is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptions_else_3:</strong> When options.sort is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptions_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 5: getSubscriptionById</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 2</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (2)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptionById_if_1:</strong> When !subscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getSubscriptionById_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 6: toggleSubscriptionStatus</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>toggleSubscriptionStatus_if_1:</strong> When !session?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>toggleSubscriptionStatus_if_2:</strong> When !subscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>toggleSubscriptionStatus_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>toggleSubscriptionStatus_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 7: getActiveSubscriptions</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 1</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (1)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getActiveSubscriptions_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 8: getActiveSubscriptionsForPurchase</h4>
                                <p><strong>拽抓:</strong> actions\subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 1</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (1)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getActiveSubscriptionsForPurchase_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 9: purchaseSubscription</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Email format validation, Israeli phone number validation, Required field validation, Date validation, Payment validation</p>
                                <p><strong>转转-转专砖:</strong> 21</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (21)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_1:</strong> When !sessionData || !sessionData.user is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_2:</strong> When subscriptionResult.status === "rejected" || treatmentResult.status === "rejected" || paymentMethodResult.status === "rejected" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_3:</strong> When !subscription || !subscription.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_4:</strong> When !treatment || !treatment.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_5:</strong> When !paymentMethod || paymentMethod.userId.toString() !== sessionData.user.id is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_6:</strong> When treatment.pricingType === "fixed" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_else_6:</strong> When treatment.pricingType === "fixed" is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_7:</strong> When treatment.pricingType === "duration_based" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_8:</strong> When !selectedDurationId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_9:</strong> When !duration || !duration.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_10:</strong> When singleSessionPrice === undefined || singleSessionPrice < 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_11:</strong> When purchaser is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_12:</strong> When methods.includes("email") && purchaser.email is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_if_13:</strong> When methods.includes("sms") && purchaser.phone is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_validation_1:</strong> Validate email: Email format validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for email
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_validation_2:</strong> Validate phone: Israeli phone number validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for phone
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_validation_3:</strong> Validate required: Required field validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for required
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_validation_4:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_validation_5:</strong> Validate payment: Payment validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for payment
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseSubscription_error_2:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 10: getUserSubscriptions</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> </p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptions_if_1:</strong> When !sessionData || !sessionData.user is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptions_if_2:</strong> When sub.treatmentId &&
        (sub.treatmentId as ITreatment).pricingType === "duration_based" &&
        sub.selectedDurationId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptions_if_3:</strong> When treatmentDoc.durations is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptions_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 11: getAllUserSubscriptions</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 9</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (9)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_1:</strong> When !sessionData?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_2:</strong> When options.userId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_3:</strong> When options.subscriptionId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_4:</strong> When options.treatmentId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_5:</strong> When options.status is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_6:</strong> When options.search is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_7:</strong> When sub.treatmentId &&
        (sub.treatmentId as ITreatment).pricingType === "duration_based" &&
        sub.selectedDurationId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_if_8:</strong> When treatmentDoc.durations is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getAllUserSubscriptions_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 12: useSubscription</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 8</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (8)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_1:</strong> When !sessionData || !sessionData.user is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_2:</strong> When !userSubscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_3:</strong> When userSubscription.userId && userSubscription.userId.toString() !== sessionData.user.id && !sessionData.user.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_4:</strong> When userSubscription.status !== "active" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_5:</strong> When userSubscription.remainingQuantity < quantity is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_if_6:</strong> When userSubscription.remainingQuantity <= 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>useSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 13: cancelSubscription</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 5</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (5)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>cancelSubscription_if_1:</strong> When !sessionData || !sessionData.user is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>cancelSubscription_if_2:</strong> When !userSubscription is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>cancelSubscription_if_3:</strong> When userSubscription.userId && userSubscription.userId.toString() !== sessionData.user.id && !sessionData.user.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>cancelSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>cancelSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 14: deleteUserSubscription</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Date validation</p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>deleteUserSubscription_if_1:</strong> When !sessionData?.user?.roles.includes("admin") is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteUserSubscription_if_2:</strong> When !result is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteUserSubscription_validation_1:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>deleteUserSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 15: purchaseGuestSubscription</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> Email format validation, Israeli phone number validation, Required field validation, Date validation, Payment validation</p>
                                <p><strong>转转-转专砖:</strong> 18</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (18)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_1:</strong> When subscriptionResult.status === "rejected" || treatmentResult.status === "rejected" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_2:</strong> When !subscription || !subscription.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_3:</strong> When !treatment || !treatment.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_4:</strong> When treatment.pricingType === "fixed" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_else_4:</strong> When treatment.pricingType === "fixed" is false<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute else branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_5:</strong> When treatment.pricingType === "duration_based" is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_6:</strong> When !selectedDurationId is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_7:</strong> When !duration || !duration.isActive is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_8:</strong> When singleSessionPrice === undefined || singleSessionPrice < 0 is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_9:</strong> When guestInfo.email is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_if_10:</strong> When guestInfo.phone is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_validation_1:</strong> Validate email: Email format validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for email
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_validation_2:</strong> Validate phone: Israeli phone number validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for phone
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_validation_3:</strong> Validate required: Required field validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for required
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_validation_4:</strong> Validate date: Date validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for date
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_validation_5:</strong> Validate payment: Payment validation<br>
                                                <strong>住:</strong> validation<br>
                                                <strong>转爪 爪驻:</strong> Validation passes/fails for payment
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>purchaseGuestSubscription_error_2:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 16: saveAbandonedSubscriptionPurchase</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 2</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (2)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>saveAbandonedSubscriptionPurchase_if_1:</strong> When existing is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>saveAbandonedSubscriptionPurchase_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                            <div class="sub-scenario">
                                <h4>砖 17: getUserSubscriptionById</h4>
                                <p><strong>拽抓:</strong> actions\user-subscription-actions.ts</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <p><strong>爪转:</strong> </p>
                                <p><strong>转转-转专砖:</strong> 4</p>
                                
                                
                                    <button class="collapsible" onclick="toggleContent(this)">转转-转专砖 (4)</button>
                                    <div class="content">
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptionById_if_1:</strong> When !mongoose.Types.ObjectId.isValid(id) is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptionById_if_2:</strong> When !sub is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptionById_if_3:</strong> When !isGuest && !isOwner && !isAdmin is true<br>
                                                <strong>住:</strong> conditional<br>
                                                <strong>转爪 爪驻:</strong> Execute if branch logic
                                            </div>
                                        
                                            <div class="scenario-item">
                                                <strong>getUserSubscriptionById_error_1:</strong> Handle try-catch error<br>
                                                <strong>住:</strong> error_handling<br>
                                                <strong>转爪 爪驻:</strong> Error handled gracefully
                                            </div>
                                        
                                    </div>
                                
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 拽 (20)</button>
                    <div class="content">
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Happy Path</h4>
                                <p><strong>住:</strong> happy_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute createSubscription</td>
                                                <td>admin</td>
                                                <td>createSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>2</td>
                                                <td>Execute updateSubscription</td>
                                                <td>admin</td>
                                                <td>updateSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>3</td>
                                                <td>Execute deleteSubscription</td>
                                                <td>admin</td>
                                                <td>deleteSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>4</td>
                                                <td>Execute getSubscriptions</td>
                                                <td></td>
                                                <td>getSubscriptions completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>5</td>
                                                <td>Execute getSubscriptionById</td>
                                                <td></td>
                                                <td>getSubscriptionById completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>6</td>
                                                <td>Execute toggleSubscriptionStatus</td>
                                                <td>admin</td>
                                                <td>toggleSubscriptionStatus completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>7</td>
                                                <td>Execute getActiveSubscriptions</td>
                                                <td></td>
                                                <td>getActiveSubscriptions completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>8</td>
                                                <td>Execute getActiveSubscriptionsForPurchase</td>
                                                <td></td>
                                                <td>getActiveSubscriptionsForPurchase completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>9</td>
                                                <td>Execute purchaseSubscription</td>
                                                <td>member or admin</td>
                                                <td>purchaseSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>10</td>
                                                <td>Execute getUserSubscriptions</td>
                                                <td></td>
                                                <td>getUserSubscriptions completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>11</td>
                                                <td>Execute getAllUserSubscriptions</td>
                                                <td>guest or admin</td>
                                                <td>getAllUserSubscriptions completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>12</td>
                                                <td>Execute useSubscription</td>
                                                <td>member or admin</td>
                                                <td>useSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>13</td>
                                                <td>Execute cancelSubscription</td>
                                                <td>member or admin</td>
                                                <td>cancelSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>14</td>
                                                <td>Execute deleteUserSubscription</td>
                                                <td>member or admin</td>
                                                <td>deleteUserSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>15</td>
                                                <td>Execute purchaseGuestSubscription</td>
                                                <td>guest or admin</td>
                                                <td>purchaseGuestSubscription completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>16</td>
                                                <td>Execute saveAbandonedSubscriptionPurchase</td>
                                                <td>guest</td>
                                                <td>saveAbandonedSubscriptionPurchase completes successfully</td>
                                            </tr>
                                        
                                            <tr>
                                                <td>17</td>
                                                <td>Execute getUserSubscriptionById</td>
                                                <td>admin</td>
                                                <td>getUserSubscriptionById completes successfully</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 1</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>1</td>
                                                <td>Execute createSubscription with error condition</td>
                                                <td>admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 2</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>2</td>
                                                <td>Execute updateSubscription with error condition</td>
                                                <td>admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 3</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>3</td>
                                                <td>Execute deleteSubscription with error condition</td>
                                                <td>admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 4</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> </p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>4</td>
                                                <td>Execute getSubscriptions with error condition</td>
                                                <td></td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 5</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> </p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>5</td>
                                                <td>Execute getSubscriptionById with error condition</td>
                                                <td></td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 6</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>6</td>
                                                <td>Execute toggleSubscriptionStatus with error condition</td>
                                                <td>admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 7</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> </p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>7</td>
                                                <td>Execute getActiveSubscriptions with error condition</td>
                                                <td></td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 8</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> </p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>8</td>
                                                <td>Execute getActiveSubscriptionsForPurchase with error condition</td>
                                                <td></td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 9</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>9</td>
                                                <td>Execute purchaseSubscription with error condition</td>
                                                <td>member or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 9</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>9</td>
                                                <td>Execute purchaseSubscription with error condition</td>
                                                <td>member or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 10</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> </p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>10</td>
                                                <td>Execute getUserSubscriptions with error condition</td>
                                                <td></td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 11</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>11</td>
                                                <td>Execute getAllUserSubscriptions with error condition</td>
                                                <td>guest or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 12</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>12</td>
                                                <td>Execute useSubscription with error condition</td>
                                                <td>member or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 13</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>13</td>
                                                <td>Execute cancelSubscription with error condition</td>
                                                <td>member or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 14</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">member</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>14</td>
                                                <td>Execute deleteUserSubscription with error condition</td>
                                                <td>member or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 15</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>15</td>
                                                <td>Execute purchaseGuestSubscription with error condition</td>
                                                <td>guest or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 15</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span><span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>15</td>
                                                <td>Execute purchaseGuestSubscription with error condition</td>
                                                <td>guest or admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 16</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">guest</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>16</td>
                                                <td>Execute saveAbandonedSubscriptionPurchase with error condition</td>
                                                <td>guest</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                            <div class="scenario-item">
                                <h4>Subscription Management - Error at Step 17</h4>
                                <p><strong>住:</strong> error_path</p>
                                <p><strong>转驻拽:</strong> <span class="user-role">admin</span></p>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>砖</th>
                                            <th>驻注</th>
                                            <th>转驻拽</th>
                                            <th>转爪 爪驻</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        
                                            <tr>
                                                <td>17</td>
                                                <td>Execute getUserSubscriptionById with error condition</td>
                                                <td>admin</td>
                                                <td>Error handled: try-catch</td>
                                            </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        
                    </div>

                    <button class="collapsible" onclick="toggleContent(this)">转专砖 爪 (34)</button>
                    <div class="content">
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>email:</strong> Valid email input<br>
                                <strong>:</strong> Email format validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>email:</strong> Invalid email input<br>
                                <strong>:</strong> Email format validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Valid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Invalid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>required:</strong> Valid required input<br>
                                <strong>:</strong> Required field validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>required:</strong> Invalid required input<br>
                                <strong>:</strong> Required field validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>payment:</strong> Valid payment input<br>
                                <strong>:</strong> Payment validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>payment:</strong> Invalid payment input<br>
                                <strong>:</strong> Payment validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>email:</strong> Valid email input<br>
                                <strong>:</strong> Email format validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>email:</strong> Invalid email input<br>
                                <strong>:</strong> Email format validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Valid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>phone:</strong> Invalid phone input<br>
                                <strong>:</strong> Israeli phone number validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>required:</strong> Valid required input<br>
                                <strong>:</strong> Required field validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>required:</strong> Invalid required input<br>
                                <strong>:</strong> Required field validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Valid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>date:</strong> Invalid date input<br>
                                <strong>:</strong> Date validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                            <div class="validation-item">
                                <strong>payment:</strong> Valid payment input<br>
                                <strong>:</strong> Payment validation<br>
                                <strong>转爪 爪驻:</strong> Validation passes
                            </div>
                        
                            <div class="validation-item">
                                <strong>payment:</strong> Invalid payment input<br>
                                <strong>:</strong> Payment validation<br>
                                <strong>转爪 爪驻:</strong> Validation fails with appropriate error message
                            </div>
                        
                    </div>
                </div>
            
        </div>

        <div class="section">
            <h2> 住注转 砖转砖</h2>
            
                <div class="flow-item">
                    <h3>Complete Booking - guest</h3>
                    <ol>
                        <li>Navigate to booking page</li><li>Fill guest information</li><li>Select treatment</li><li>Choose date and time</li><li>Enter address</li><li>Make payment</li><li>Receive confirmation</li>
                    </ol>
                </div>
            
                <div class="flow-item">
                    <h3>Book with Subscription - member</h3>
                    <ol>
                        <li>Login to account</li><li>Navigate to booking</li><li>Select subscription treatment</li><li>Choose date and time</li><li>Select saved address</li><li>Confirm booking (no payment)</li><li>Receive confirmation</li>
                    </ol>
                </div>
            
                <div class="flow-item">
                    <h3>Respond to Booking - professional</h3>
                    <ol>
                        <li>Receive SMS notification</li><li>Click response link</li><li>View booking details</li><li>Accept or decline</li><li>Update booking status</li><li>Complete service</li><li>Mark as completed</li>
                    </ol>
                </div>
            
        </div>

        <div class="section">
            <h2> 转专砖 专-转驻拽</h2>
            
                <div class="flow-item">
                    <h3>Booking with Professional Assignment</h3>
                    <p><strong>转驻拽 注专:</strong> <span class="user-role">guest/member</span><span class="user-role">professional</span><span class="user-role">admin</span></p>
                    <ol>
                        <li>Customer creates booking</li><li>System finds suitable professionals</li><li>SMS sent to professionals</li><li>Professional responds within 30 minutes</li><li>Booking assigned to professional</li><li>Other professionals notified</li><li>Admin monitors if no response</li>
                    </ol>
                </div>
            
        </div>

        <div class="section">
            <h2> 转专砖 专爪</h2>
            
                <div class="integration-item">
                    <h3>SMS Service</h3>
                    <ul>
                        <li>SMS sent successfully</li><li>SMS service unavailable</li><li>SMS delivery delayed</li><li>Invalid phone number</li>
                    </ul>
                </div>
            
                <div class="integration-item">
                    <h3>Payment Gateway</h3>
                    <ul>
                        <li>Payment processed successfully</li><li>Payment declined</li><li>Payment gateway timeout</li><li>Invalid payment method</li>
                    </ul>
                </div>
            
        </div>

        <div class="section">
            <h2> 转专砖 </h2>
            
                <div class="error-item">
                    <h3>Authentication</h3>
                    <ul>
                        <li>Valid user login</li><li>Invalid credentials</li><li>Session expiry</li><li>Unauthorized access attempt</li>
                    </ul>
                </div>
            
                <div class="error-item">
                    <h3>Authorization</h3>
                    <ul>
                        <li>Admin accessing admin functions</li><li>Member accessing member functions</li><li>Cross-role access attempt</li><li>Unauthenticated access attempt</li>
                    </ul>
                </div>
            
        </div>
    </div>

    <script>
        function toggleContent(button) {
            const content = button.nextElementSibling;
            content.classList.toggle('active');
            button.textContent = content.classList.contains('active') ? 
                button.textContent.replace('', '') : 
                button.textContent.replace('', '');
        }
    </script>
</body>
</html>