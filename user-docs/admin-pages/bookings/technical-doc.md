# תהליך ניהול ההזמנות
מסך זה מאפשר למנהל לצפות בכל ההזמנות, ליצור חדשות ולערוך הזמנות קיימות.

## תהליך טעינת הדף
- עם כניסה לכתובת `/dashboard/admin/bookings` מופעל `requireUserSession` לבדיקת הרשאה.
- הדף מוגדר כ־`force-dynamic` כדי לאפשר חיבור למסד הנתונים בזמן ריצה.
- הקומפוננטה הראשית `AdminBookingsClient` נטענת בתוך `Suspense` כאשר שלד הטבלה (`BookingsTableSkeleton`) מוצג בעת הטעינה.

## ניהול נתונים וסטטיסטיקות
- הפונקציה `getAllBookings` ב`actions.ts` מקבלת מסננים (סטטוס, מטפל, טיפול, טווח תאריכים, מחיר וכתובת) ומחזירה רשימת הזמנות, מספר עמודים ומספר כולל.
- הנתונים עוברים עיבוד נוסף: השלמת מידע על המטפל, חישוב מרחק מכתובת הלקוח והמרת מזהים למחרוזות.

## ניהול רשימת ההזמנות
- `AdminBookingsClient` שומר את מצב המסננים והדף הנוכחי ב־state, ומבצע קריאות React Query בהתאם לשינויים.
- בטבלה מוצגים מספר הזמנה, סטטוס, פרטי הלקוח, כתובת, תאריך ושעה, טיפול, מטפל, פרטי מחיר ופעולות ניהול.
- ניתן לפתוח מודל עריכה מורחב (`EnhancedBookingModal`) או לעבור לדף עריכה מלא.

## פעולות CRUD
- יצירת הזמנה מתבצעת ב־`new/page.tsx` דרך רכיב `BookingCreatePage` המחולק לשישה שלבים (לקוח, טיפול, תזמון, כתובת, תשלום, אישור) ומשתמש בפעולה `createBooking` שב־`actions.ts`.
- עריכת הזמנה קיימת בדף `[bookingId]/page.tsx` מפעילה `updateBookingByAdmin` לשמירת שינויים, `assignProfessionalToBooking` לשיוך מטפל ו־`cancelBooking` לביטול.
- כל פעולה מחזירה אובייקט הצלחה או שגיאה ומבצעת `revalidatePath` לעדכון הנתונים.

## ולידציה ואימות
- פעולות השרת בודקות שהמשתמש המחובר הוא בעל תפקיד `admin`.
- לפני יצירה או עדכון מופעלות סכימות ולידציה במודלי Mongoose (כגון `Booking` ו־`Treatment`).
- בקשות מהלקוח מאומתות גם בצד הלקוח לפני שליחה (לדוגמה, בשלב יצירת הלקוח נבדקים שדות חובה).

## ניהול מצב ומשוב
- במקרים של שגיאות קריטיות מוצג `BookingsErrorBoundary` עם כפתור רענון.
- פקדי ה־UI מציגים מצב טעינה ושגיאות באמצעות `useToast` ו־`sonner`.
- React Query מטפל במצב טעינה, קאש וניסיונות חוזרים אוטומטיים.
