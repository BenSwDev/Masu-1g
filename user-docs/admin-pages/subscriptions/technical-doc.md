# תהליך ניהול המנויים

מסך זה אחראי ליצירה, עריכה ומחיקה של מנויים במערכת. כל הפעולות מתבצעות דרך פונקציות השרת שב־`actions.ts` ומוצגות למנהל באמצעות רכיבי React.

## תהליך טעינת הדף
1. בטעינה מופעלת `requireUserSession` לוודא שהמשתמש מחובר.
2. מבוצעות הקריאות `getSubscriptions` ו־`getAllTreatments` לקבלת רשימת מנויים וטיפולים זמינים.
3. הנתונים מועברים לרכיב `SubscriptionsClient` שמציג את המידע ומטפל בהמשך האינטראקציה.

## ניהול נתונים וסטטיסטיקות
- המנויים מאוחסנים במודל `Subscription` במסד MongoDB.
- הפונקציה `getSubscriptions` תומכת בסינון לפי סטטוס (פעיל/לא פעיל), חיפוש טקסטואלי, מיון, פאגינציה והחזרת מספר עמודים כולל.
- `getAllTreatments` מחזירה את רשימת הטיפולים הפעילים לשיוך למנוי.

## ניהול רשימת המנויים
- `SubscriptionsClient` שומר את המנויים במצב מקומי ומאפשר רענון מהרשת בעת חיפוש או מעבר עמוד.
- כפתור "הוסף מנוי חדש" פותח דיאלוג יצירה שמבוסס על `SubscriptionForm`.
- כל כרטיס (`SubscriptionCard`) מציג פרטים מרכזיים וכולל כפתורי עריכה ומחיקה.

## פעולות CRUD
- `createSubscription` יוצר מסמך חדש לאחר ולידציה ומחזיר את המנוי החדש.
- `updateSubscription` מקבל מזהה מנוי ו־`FormData` ומעדכן את השדות הרלוונטיים.
- `deleteSubscription` מסיר את המסמך מהמסד.
- `toggleSubscriptionStatus` משנה את ערך `isActive` ומעדכן את זמן העדכון.
- לאחר כל פעולה מתבצע `revalidatePath` לרענון הדף.

## ולידציה ואימות
- הסכימה `subscriptionSchema` מוודאת שכל השדות חובה מולאו: שם, תיאור, כמות, בונוס, מספר חודשי תוקף וסטטוס.
- צד הלקוח משתמש ב־`react-hook-form` עם `zodResolver` להציג הודעות שגיאה מיידיות.
- פעולות השרת מאמתות הרשאות מנהל באמצעות `getServerSession` ובודקות שגיאות באמצעות `try/catch` ורישום ביומן (`logger`).

## ניהול מצב ומשוב
- מצבי טעינה נשמרים ב־`useState` ומוצגים ברכיבי `Skeleton` או טקסט.
- הצלחות וכשלונות מוצגות למנהל בעזרת `toast`.
- פאגינציה ומסננים מחזירים את המשתמש לעמוד הראשון בעת שינוי החיפוש או הסטטוס.
