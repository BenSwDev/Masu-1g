# הוראות העלאה לייצור - MASU Platform

## מטרה: העלאת האתר לאוויר היום

### בדיקות קריטיות לפני העלאה

#### 1. תהליכי הזמנה - בדיקה מקיפה

**אורח (Guest Booking):**
- [ ] בדיקת תהליך הזמנת טיפול רגיל מתחילה לסוף
- [ ] בדיקת תהליך הזמנה עם "דמיית תשלום"
- [ ] וידוא שההפניה לעמוד פרטי ההזמנה עובדת (השינוי האחרון)
- [ ] בדיקת קבלת SMS/אימייל אישור למזמין
- [ ] בדיקת שליחת התראות למטפלים מתאימים

**משתמש רשום (Member):**
- [ ] בדיקת הזמנה רגילה עם תשלום
- [ ] בדיקת מימוש מנוי/גיפט קארד
- [ ] בדיקת הזמנה עבור מישהו אחר
- [ ] וידוא שמירת פרטי ההזמנה בפרופיל המשתמש

**רכישות:**
- [ ] בדיקת רכישת מנוי (subscription)
- [ ] בדיקת רכישת גיפט קארד
- [ ] וידוא תהליך תשלום עובד (CARDCOM)
- [ ] בדיקת קבלת אישורי רכישה

#### 2. תהליכי מטפלים

**קבלת התראות:**
- [ ] בדיקה שמטפלים מקבלים SMS על הזמנות חדשות
- [ ] בדיקה שמטפלים מקבלים אימייל עם לינק לניהול
- [ ] וידוא שהלינק מוביל לעמוד הניהול הנכון
- [ ] בדיקת התראות על הקצאת הזמנה על ידי מנהל

**ניהול הזמנות:**
- [ ] בדיקת יכולת אישור/דחיית הזמנות
- [ ] בדיקת עדכון סטטוס הזמנה
- [ ] וידוא שהלקוח מקבל עדכונים על שינויים

#### 3. פאנל מנהל

**ניהול הזמנות:**
- [ ] בדיקת צפייה בכל ההזמנות
- [ ] בדיקת הקצאת מטפלים להזמנות
- [ ] בדיקת עדכון סטטוסים
- [ ] וידוא שהתראות נשלחות בעת הקצאה ידנית

**ניהול מטפלים:**
- [ ] בדיקת הוספת מטפלים חדשים
- [ ] בדיקת עדכון פרטי מטפלים
- [ ] בדיקת הגדרות העדפות התראות

**דוחות ותשלומים:**
- [ ] בדיקת דוחות מכירות
- [ ] בדיקת ניהול תשלומים
- [ ] וידוא נתונים מדויקים

### הגדרות סביבת ייצור

#### 1. משתני סביבה (Environment Variables)

**בסיס נתונים:**
```
MONGODB_URI=mongodb+srv://[production-connection-string]
DB_NAME=masu-production
```

**אימות:**
```
NEXTAUTH_URL=[production-domain]
NEXTAUTH_SECRET=[strong-production-secret]
JWT_SECRET=[strong-jwt-secret]
```

**CARDCOM תשלומים:**
```
CARDCOM_TERMINAL=125566
CARDCOM_API_TOKEN=Q3ZqTMTZGrSIKjktQrfN
CARDCOM_BASE_URL=https://secure.cardcom.solutions/api/v11
CARDCOM_TEST_MODE=false
```

**SMS (משלוח הודעות):**
```
SMS_API_KEY=[production-sms-key]
SMS_API_URL=[sms-provider-url]
SMS_SENDER_NAME=MASU
```

**אימייל:**
```
EMAIL_HOST=[email-provider-host]
EMAIL_PORT=587
EMAIL_USER=[email-account]
EMAIL_PASS=[email-password]
EMAIL_FROM=noreply@masu.co.il
```

#### 2. הגדרות אבטחה

**HTTPS:**
- [ ] וידוא שהאתר רץ על HTTPS
- [ ] בדיקת תעודת SSL תקפה

**Headers אבטחה:**
- [ ] Content Security Policy
- [ ] X-Frame-Options
- [ ] X-XSS-Protection
- [ ] Strict-Transport-Security

#### 3. ביצועים ותצוגה

**אופטימיזציה:**
- [ ] בדיקת זמני טעינה של עמודים
- [ ] וידוא תמונות ממוטבות
- [ ] בדיקת responsive design על מכשירים שונים

**SEO:**
- [ ] בדיקת meta tags
- [ ] וידוא sitemap.xml
- [ ] בדיקת robots.txt

### בדיקות פונקציונליות מקיפות

#### 1. תרחיש אורח מלא
1. כניסה לאתר כאורח
2. בחירת טיפול
3. מילוי פרטים ותאריך
4. ביצוע "דמיית תשלום"
5. בדיקה שמגיעים לעמוד פרטי ההזמנה
6. וידוא SMS/אימייל למזמין
7. בדיקה שמטפלים מקבלים התראות

#### 2. תרחיש משתמש רשום מלא
1. הרשמה/התחברות
2. ביצוע הזמנה עם תשלום אמיתי
3. בדיקת מימוש מנוי (אם קיים)
4. צפייה בהיסטוריית הזמנות
5. עדכון פרטי פרופיל

#### 3. תרחיש מטפל מלא
1. קבלת התראת הזמנה חדשה
2. כניסה לעמוד ניהול הזמנות
3. אישור/דחיית הזמנה
4. בדיקה שהלקוח מקבל עדכון

#### 4. תרחיש מנהל מלא
1. כניסה לפאנל מנהל
2. צפייה בהזמנות ממתינות
3. הקצאת מטפל להזמנה
4. בדיקה שהמטפל מקבל התראה
5. צפייה בדוחות

### תיקונים קריטיים שנמצאו

#### 1. התראות מטפלים ✅ (תוקן)
- תוקנה בעיית התראות כלליות
- מטפלים מקבלים עכשיו הודעות מפורטות עם קישור ניהול

#### 2. הפניה לאחר הזמנה ✅ (תוקן זה עתה)
- שונתה ההפניה מעמוד אישור לעמוד פרטי ההזמנה

#### 3. חיבור CARDCOM מלא ✅ (הושלם זה עתה)
- עודכן שירות CARDCOM עם הפרטים החדשים (Terminal: 125566, API Token)
- נוסף תמיכה ב-Low Profile (iframe) payments
- נוסף תמיכה בחיוב ישיר עם טוקנים וכרטיסי אשראי
- נוסף מעבר בין מצב TEST ל-PRODUCTION
- נוסף פאנל מנהל לניהול הגדרות CARDCOM
- עודכנו כל ה-APIs לעבוד עם השירות החדש

#### 3. בדיקות נוספות נדרשות:

**API Endpoints:**
- [ ] `/api/bookings/create` - יצירת הזמנות
- [ ] `/api/payments/create` - יצירת תשלומים CARDCOM
- [ ] `/api/payments/callback` - קבלת תוצאות תשלום
- [ ] `/api/admin/bookings/[id]/assign` - הקצאת מטפלים
- [ ] `/api/professional/response/[id]` - תגובות מטפלים
- [ ] `/api/admin/payments/cardcom-config` - ניהול הגדרות CARDCOM

**שגיאות ו-Edge Cases:**
- [ ] בדיקת טיפול בשגיאות תשלום
- [ ] בדיקת תפוגת סשן
- [ ] בדיקת הזמנות כפולות
- [ ] בדיקת העמסה על השרת

### רשימת בדיקה סופית לפני Go-Live

**טכני:**
- [ ] כל משתני הסביבה מוגדרים נכון
- [ ] בסיס הנתונים זמין ויציב
- [ ] שירותי צד שלישי (CARDCOM, SMS) עובדים
- [ ] SSL תקף ופעיל
- [ ] DNS מכוון נכון

**פונקציונלי:**
- [ ] כל התרחישים הקריטיים נבדקו
- [ ] התראות נשלחות ומתקבלות
- [ ] תשלומים עובדים
- [ ] פאנל מנהל פונקציונלי

**ביצועים:**
- [ ] זמני טעינה מקובלים (< 3 שניות)
- [ ] האתר יציב תחת עומס
- [ ] ממשק משתמש responsive

**אבטחה:**
- [ ] נתונים רגישים מוצפנים
- [ ] אין חשיפת מידע לא מורשה
- [ ] הרשאות עובדות נכון

### מה לעשות במקרה של בעיות

**שגיאות תשלום:**
1. בדיקת הגדרות CARDCOM
2. וידוא שלמות נתוני כרטיס אשראי
3. בדיקת logs לשגיאות ספציפיות

**בעיות התראות:**
1. בדיקת הגדרות SMS/Email
2. וידוא שמספרי טלפון ואימיילים תקינים
3. בדיקת queue של הודעות

**בעיות ביצועים:**
1. בדיקת logs שרת
2. אופטימיזציה של קוד
3. שיפור חיבור בסיס נתונים

### סיכום לפני העלאה

לפני העלאה לייצור יש לוודא ב-100% ביטחון שכל הפונקציות הקריטיות עובדות:
1. אורחים יכולים להזמין טיפולים
2. משתמשים רשומים יכולים להזמין ולמש
3. מטפלים מקבלים התראות ויכולים לנהל הזמנות
4. מנהלים יכולים לצפות ולנהל את כל המערכת
5. תשלומים עובדים ללא תקלות

**האתר מוכן לעלייה לאוויר רק כאשר כל הסעיפים מעלה מסומנים ✅**
