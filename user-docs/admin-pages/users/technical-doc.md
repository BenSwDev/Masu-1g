# תהליך ניהול המשתמשים

מסך זה אחראי על יצירת משתמשים חדשים, עריכתם וניהול הסטטוס והתפקידים שלהם.

## תהליך טעינת הדף
בעת הכניסה לנתיב נבדקת ההרשאה באמצעות `requireUserSession`. לאחר מכן נקראות הפונקציות `getUserStats` ו־`getAllUsers` שמחזירות את נתוני הסטטיסטיקה והרשימה הראשונית של המשתמשים.

## ניהול נתונים וסטטיסטיקות
הפונקציה `getUserStats` מבצעת שאילתות אגרגציה במונגו־די־בי לספירת משתמשים פעילים, מאומתים, הרשמות אחרונות והתפלגות תפקידים ומגדרים. תוצאה זו מוצגת בכרטיסי סטטיסטיקה בראש העמוד.

## ניהול רשימת המשתמשים
רכיב `UserManagementClient` שומר במצבו את רשימת המשתמשים הנוכחית והמסננים. שינוי מסנן או מעבר עמוד מעדכן את כתובת ה־URL ושולח בקשה חדשה ל־`getAllUsers` לקבלת הנתונים העדכניים.

## פעולות CRUD
- `createUser` – יוצר משתמש חדש לאחר בדיקות ייחודיות וסיסמה מוצפנת.
- `updateUser` – מעדכן פרטי משתמש קיים וכולל בדיקות לשדות כפולים.
- `deleteUser` – מבצע הסתרה רכה על ידי `isActive:false`.
- `permanentlyDeleteUser` – מוחק לחלוטין רשומה מהמסד.
- `resetUserPassword` – מאפס סיסמה ומחזיר אותה למנהל.
- `toggleUserRole` ו־`toggleUserStatus` – משנות תפקידים וסטטוס פעיל/לא פעיל.

## ולידציה ואימות
שני הדיאלוגים משתמשים ב־`zod` ו־`react-hook-form` לאימות צד לקוח, ובפעולות השרת קיימות בדיקות נוספות לוודא ייחודיות טלפון/דוא"ל ותוקף מזהה.

## ניהול מצב ומשוב
הלקוח מציג מצבי טעינה ושגיאות באמצעות `useToast` ו־`useTransition`. לאחר כל פעולה מוצג משוב מיידי ומבוצע רענון לרשימת המשתמשים.
