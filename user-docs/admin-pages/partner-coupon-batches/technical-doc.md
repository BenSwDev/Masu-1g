# תהליך ניהול אצוות קופוני שותפים

מסך זה מטפל ביצירה וניהול של אצוות קופונים המיועדים לשותפים. כל אצווה מקבלת קוד בסיס ממנו נגזרים קופונים בודדים.

## תהליך טעינת הדף
- בכניסה לדף נבדקת ההרשאה באמצעות `requireUserSession`.
- מתבצעת קריאה ל־`getPartnerCouponBatches` עם פרמטרי סינון ופאגינציה מה־URL.
- במקביל נטענים נתוני השותפים באמצעות `getPartnersForSelection` להצגה בטופס.
- התוצאות מועברות ל־`PartnerCouponBatchesClient` המנהל את מצב הטבלה והמודאלים.

## ניהול נתונים וסטטיסטיקות
- פונקציית `getPartnerCouponBatches` מחזירה מספר כולל של אצוות, עמודים נוכחיים וספירת קופונים פעילים בכל אצווה.
- הפריסה בצד הלקוח מציגה טבלה או כרטיסים בהתאם לרוחב המסך ומשלבת פאגינציה מקומית.

## ניהול רשימת האצוות
- ניתן לסנן לפי שם, סטטוס פעילות, שותף משויך וסטטוס אפקטיבי (פעיל, מתוזמן, לא פעיל או פג תוקף).
- הטבלה עושה שימוש ב־`partner-coupon-batches-columns.tsx` כדי להציג עמודות ופעולות.

## פעולות CRUD
- יצירה (`createPartnerCouponBatch`) – יוצרת אצווה חדשה ומייצרת מספר קופונים ייחודיים בהתאם לכמות המבוקשת.
- עדכון (`updatePartnerCouponBatch`) – משנה פרטים קיימים ומעדכנת את כל הקופונים המשויכים.
- מחיקה (`deletePartnerCouponBatch`) – מוחקת את האצווה וכל הקופונים שלה.
- צפייה בקופונים (`getBatchCoupons`) – מחזירה את רשימת הקופונים עם סטטוס אפקטיבי לכל אחד.
- עדכון מרוכז (`updateCouponsInBatch`) – מאפשר להפעיל או להשבית מספר קופונים בבת אחת.

## ולידציה ואימות
- צד הלקוח מאמת את הטפסים באמצעות `zod` ו־`react-hook-form`.
- צד השרת חוזר ומוודא את הנתונים לפני שמירה במסד הנתונים.

## ניהול מצב ומשוב
- הודעות הצלחה ושגיאה מוצגות דרך `useToast`.
- לאחר כל פעולה מתבצע `revalidatePath` כדי לטעון מחדש את הנתונים מהשרת.
