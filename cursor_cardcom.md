# ××“×¨×™×š ×œ×™×™×©×•× ×ª×§×©×•×¨×ª ×¢× CARDCOM
_Exported on 6/16/2025 at 12:55:28 GMT+3 from Cursor (1.0.0)_

---


**User**

×× ×™ ×¨×•×¦×” ×©×ª×™×¦×•×¨ ×§×•×‘×¥ ×©×™×¡×™×™×¢ ×œ×¢×¦××š ×œ×”×¡×‘×™×¨ ×‘×“×™×•×§ ×›×™×¦×“ ×œ×™×™×©× ××ª ×”×ª×§×©×•×¨×ª ×¢× CARDCOM ×‘×¤×¨×•×™×™×§×˜ ××—×¨ ×©×ª×”×™×” ××—×•×‘×¨ ××œ×™×• ×‘××•×¤×Ÿ ××•×©×œ×, ×œ×¤×™ ×”×¡×‘×¨×™× ×‘×¨×•×¨×™× ×•×—×“ ××©××¢×™×™× ×œ×›×š ×©×”×•× ×™×‘×™×××•×ª×™ ×œ××¦×‘ ×©×œ××—×¨ ×©×”×•× ×™×™×“×¢ ×›×™×¦×“ ×‘×“×™×•×§ ×œ×××© ××ª ×–×”, ×”×•× ×™×ª××™× ××ª ×”×§×•×“ ××•×©×œ× ×•×›×š ×œ× ××¦×˜×¨×š ×œ×¢×©×•×ª ×“×‘×¨, ×”×•× ×™×™×“×¢ ×œ×¢×©×•×ª ××“×¤×˜×¦×™×” ××“×•×™×™×§×ª ×œ×¤×™ ×›×š ×©×ª×©×œ×•× ×××•×§× ×’× ×›×›×” ×‘××•×¤×Ÿ ×ª×™××•×¨×˜×™ ×¨×§ ×‘××§×•× ××—×“ ×’× ×‘××ª×¨ ×©×œ×™, ××– ×¨×§ ×¦×¨×™×š ×œ×“×¢×ª ××” ×‘×“×™×•×§ ×§×•×¨×” ×›×“×™ ×œ×™×©× ××•×ª×• ×‘×¤×¨×•×™×™×§×˜ ×”×—×“×© ×•×¨×§ ×œ×—×‘×¨ ×œ×¨×’×¢ ×”×ª×©×œ×•×

×—×›× ×œ×?

---

**Cursor**

×× ×™ ××‘×™×Ÿ ×©××ª×” ×¨×•×¦×” ×©××™×¦×•×¨ ××“×¨×™×š ××¤×•×¨×˜ ×œ×™×™×©×•× ×ª×§×©×•×¨×ª ×¢× CARDCOM ×©×™××¤×©×¨ ×œ×š ×œ×”×¢×ª×™×§ ××ª ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×œ×¤×¨×•×™×§×˜ ××—×¨ ×‘×§×œ×•×ª. ×‘×•××• × ×—×§×•×¨ ××ª ×”×§×•×“ ×”×§×™×™× ×›×“×™ ×œ×”×‘×™×Ÿ ××™×š ×”×ª×©×œ×•× ××™×•×©× ×›×¨×’×¢.

×¢×›×©×™×• ×× ×™ ××‘×™×Ÿ ××ª ×”××‘× ×”! ×‘×•××• ××—×¤×© ×¢×•×“ ××™×“×¢ ×¢×œ ×”×§×‘×¦×™× ×”×—×™×¦×•× ×™×™× ×©××˜×¤×œ×™× ×‘×ª×©×œ×•××™×:

×¢×›×©×™×• ×™×© ×œ×™ ×”×‘× ×” ×˜×•×‘×” ×©×œ ×”××¢×¨×›×ª! ×‘×•××• ××¦×•×¨ ××“×¨×™×š ××¤×•×¨×˜ ×œ×™×™×©×•× CARDCOM:

```markdown
# ××“×¨×™×š ×™×™×©×•× ×ª×§×©×•×¨×ª CARDCOM - ××“×¨×™×š ××¤×•×¨×˜ ×•××•×©×œ×

## ×¡×§×™×¨×” ×›×œ×œ×™×ª
××“×¨×™×š ×–×” ××¡×¤×§ ×”×•×¨××•×ª ××“×•×™×§×•×ª ×œ×™×™×©×•× ××¢×¨×›×ª ×”×ª×©×œ×•××™× CARDCOM ×‘×¤×¨×•×™×§×˜ ×—×“×©, ×‘×”×ª×‘×¡×¡ ×¢×œ ×”×§×•×“ ×”×§×™×™× ×‘××¢×¨×›×ª MASU.

## ××¨×›×™×˜×§×˜×•×¨×ª ×”××¢×¨×›×ª

### 1. ××‘× ×” ×”×§×‘×¦×™× ×”× ×“×¨×©
```
project_root/
â”œâ”€â”€ partners/
â”‚   â”œâ”€â”€ classes/
â”‚   â”‚   â”œâ”€â”€ class.PayEngine.php
â”‚   â”‚   â”œâ”€â”€ class.CardCom.php
â”‚   â”‚   â””â”€â”€ class.MasuPay.php
â”‚   â””â”€â”€ cardcom_re/
â”‚       â””â”€â”€ result_functions.php
â”œâ”€â”€ sendgrid/
â”‚   â””â”€â”€ sendgrid-php.php
â””â”€â”€ your_payment_files/
    â”œâ”€â”€ payment_form.php
    â”œâ”€â”€ payment_process.php
    â””â”€â”€ payment_result.php
```

### 2. ××‘× ×” ×‘×¡×™×¡ ×”× ×ª×•× ×™× ×”× ×“×¨×©

#### ×˜×‘×œ×ª `orders` (×”×–×× ×•×ª)
```sql
CREATE TABLE `orders` (
  `orderID` int(11) NOT NULL AUTO_INCREMENT,
  `originalID` int(11) DEFAULT NULL,
  `customerName` varchar(255) DEFAULT NULL,
  `customerPhone` varchar(20) DEFAULT NULL,
  `customerEmail` varchar(255) DEFAULT NULL,
  `customerID` int(11) DEFAULT NULL,
  `price` decimal(10,2) DEFAULT NULL,
  `order_status` enum('pending','processing','completed','cancelled','refunded','failed') DEFAULT 'pending',
  `cc_data` text DEFAULT NULL,
  `create_date` timestamp DEFAULT CURRENT_TIMESTAMP,
  `timeFrom` datetime DEFAULT NULL,
  `timeUntil` datetime DEFAULT NULL,
  `fictive_status` int(11) DEFAULT NULL,
  `confirm_time` datetime DEFAULT NULL,
  PRIMARY KEY (`orderID`)
);
```

#### ×˜×‘×œ×ª `orderPayments` (×ª×©×œ×•××™×)
```sql
CREATE TABLE `orderPayments` (
  `lineID` int(11) NOT NULL AUTO_INCREMENT,
  `orderID` int(11) NOT NULL,
  `payType` enum('ccard','refund','cash') DEFAULT 'ccard',
  `subType` enum('direct','token','manual') DEFAULT 'direct',
  `startTime` datetime DEFAULT NULL,
  `endTime` datetime DEFAULT NULL,
  `sum` decimal(10,2) DEFAULT NULL,
  `complete` tinyint(1) DEFAULT 0,
  `token` tinyint(1) DEFAULT 0,
  `transID` varchar(255) DEFAULT NULL,
  `inputData` text DEFAULT NULL,
  `resultData` text DEFAULT NULL,
  PRIMARY KEY (`lineID`),
  KEY `orderID` (`orderID`)
);
```

## 3. ×§×‘×¦×™ ×”×œ×™×‘×” ×”× ×“×¨×©×™×

### class.MasuPay.php - ×”××—×œ×§×” ×”×¨××©×™×ª
```php
<?php
class MasuPay {
    private $cardcom;
    
    public function __construct() {
        $this->cardcom = new CardCom();
    }
    
    /**
     * ×‘×™×¦×•×¢ ×—×™×•×‘ ×™×©×™×¨ ×¢× ×˜×•×§×Ÿ
     */
    public function directPay($amount, $description, $tokenData, $orderID) {
        try {
            $result = $this->cardcom->chargeToken([
                'amount' => $amount,
                'description' => $description,
                'token' => $tokenData['token'],
                'orderID' => $orderID
            ]);
            
            return [
                'success' => $result['success'],
                'transID' => $result['transactionId'] ?? null,
                'message' => $result['message'] ?? '',
                'tokenData' => $tokenData
            ];
        } catch (Exception $e) {
            return [
                'success' => false,
                'message' => $e->getMessage(),
                'transID' => null
            ];
        }
    }
    
    /**
     * ×‘×™×¦×•×¢ ×–×™×›×•×™ ×¢× ×˜×•×§×Ÿ
     */
    public function directRefund($amount, $description, $tokenData, $orderID) {
        try {
            $result = $this->cardcom->refundToken([
                'amount' => $amount,
                'description' => $description,
                'token' => $tokenData['token'],
                'orderID' => $orderID
            ]);
            
            return [
                'success' => $result['success'],
                'transID' => $result['transactionId'] ?? null,
                'message' => $result['message'] ?? '',
                'tokenData' => $tokenData
            ];
        } catch (Exception $e) {
            return [
                'success' => false,
                'message' => $e->getMessage(),
                'transID' => null
            ];
        }
    }
}
```

### class.CardCom.php - ×××©×§ CARDCOM
```php
<?php
class CardCom {
    private $terminalNumber;
    private $userName;
    private $apiKey;
    private $baseUrl;
    
    public function __construct() {
        // ×”×’×“×¨×•×ª CARDCOM - ×™×© ×œ×”×—×œ×™×£ ×‘× ×ª×•× ×™× ×”×××™×ª×™×™×
        $this->terminalNumber = 'YOUR_TERMINAL_NUMBER';
        $this->userName = 'YOUR_USERNAME';
        $this->apiKey = 'YOUR_API_KEY';
        $this->baseUrl = 'https://secure.cardcom.solutions/api/v11/';
    }
    
    /**
     * ×™×¦×™×¨×ª ×ª×©×œ×•× ×—×“×©
     */
    public function createPayment($data) {
        $payload = [
            'TerminalNumber' => $this->terminalNumber,
            'UserName' => $this->userName,
            'APIKey' => $this->apiKey,
            'Operation' => 1, // ×—×™×•×‘
            'Currency' => 1, // ×©×§×œ
            'Sum' => $data['amount'],
            'Description' => $data['description'],
            'ReturnValue' => $data['orderID'],
            'SuccessRedirectUrl' => $data['successUrl'],
            'ErrorRedirectUrl' => $data['errorUrl'],
            'CreateToken' => true // ×™×¦×™×¨×ª ×˜×•×§×Ÿ ×œ×—×™×•×‘×™× ×¢×ª×™×“×™×™×
        ];
        
        return $this->sendRequest('LowProfile', $payload);
    }
    
    /**
     * ×—×™×•×‘ ×¢× ×˜×•×§×Ÿ ×§×™×™×
     */
    public function chargeToken($data) {
        $payload = [
            'TerminalNumber' => $this->terminalNumber,
            'UserName' => $this->userName,
            'APIKey' => $this->apiKey,
            'Operation' => 1,
            'Currency' => 1,
            'Sum' => $data['amount'],
            'Description' => $data['description'],
            'Token' => $data['token'],
            'ReturnValue' => $data['orderID']
        ];
        
        return $this->sendRequest('Charge', $payload);
    }
    
    /**
     * ×–×™×›×•×™ ×¢× ×˜×•×§×Ÿ
     */
    public function refundToken($data) {
        $payload = [
            'TerminalNumber' => $this->terminalNumber,
            'UserName' => $this->userName,
            'APIKey' => $this->apiKey,
            'Operation' => 2, // ×–×™×›×•×™
            'Currency' => 1,
            'Sum' => $data['amount'],
            'Description' => $data['description'],
            'Token' => $data['token'],
            'ReturnValue' => $data['orderID']
        ];
        
        return $this->sendRequest('Charge', $payload);
    }
    
    /**
     * ×©×œ×™×—×ª ×‘×§×©×” ×œ-CARDCOM
     */
    private function sendRequest($endpoint, $data) {
        $url = $this->baseUrl . $endpoint;
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, [
            'Content-Type: application/json',
            'Accept: application/json'
        ]);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
        curl_setopt($ch, CURLOPT_TIMEOUT, 30);
        
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        $error = curl_error($ch);
        curl_close($ch);
        
        if ($error) {
            throw new Exception('CURL Error: ' . $error);
        }
        
        if ($httpCode !== 200) {
            throw new Exception('HTTP Error: ' . $httpCode);
        }
        
        $result = json_decode($response, true);
        
        if (json_last_error() !== JSON_ERROR_NONE) {
            throw new Exception('JSON Decode Error: ' . json_last_error_msg());
        }
        
        return $result;
    }
}
```

## 4. ×“×£ ×”×ª×©×œ×•× (payment_form.php)

```php
<?php
// ×”×›× ×ª ×”×–×× ×” ×œ×ª×©×œ×•×
$orderID = $_GET['orderID'] ?? 0;
$order = udb::single_row("SELECT * FROM orders WHERE orderID = " . intval($orderID));

if (!$order) {
    die('×”×–×× ×” ×œ× × ××¦××”');
}

// ×™×¦×™×¨×ª ×ª×©×œ×•× ×‘-CARDCOM
include_once 'partners/classes/class.CardCom.php';
$cardcom = new CardCom();

$paymentData = [
    'amount' => $order['price'],
    'description' => '×”×–×× ×” ××¡×¤×¨ ' . $order['orderID'],
    'orderID' => $order['orderID'],
    'successUrl' => 'https://yoursite.com/payment_success.php',
    'errorUrl' => 'https://yoursite.com/payment_error.php'
];

try {
    $paymentResult = $cardcom->createPayment($paymentData);
    
    if ($paymentResult['ResponseCode'] == 0) {
        // ×©××™×¨×ª × ×ª×•× ×™ ×”×ª×©×œ×•×
        $payID = udb::insert('orderPayments', [
            'orderID' => $order['orderID'],
            'payType' => 'ccard',
            'subType' => 'token',
            'startTime' => date('Y-m-d H:i:s'),
            'sum' => $order['price'],
            'inputData' => json_encode($paymentData, JSON_UNESCAPED_UNICODE)
        ]);
        
        // ×”×¤× ×™×” ×œ×“×£ ×”×ª×©×œ×•× ×©×œ CARDCOM
        header('Location: ' . $paymentResult['url']);
        exit;
    } else {
        throw new Exception($paymentResult['Description']);
    }
} catch (Exception $e) {
    echo '×©×’×™××” ×‘×™×¦×™×¨×ª ×”×ª×©×œ×•×: ' . $e->getMessage();
}
?>
```

## 5. ×¢×™×‘×•×“ ×ª×•×¦××•×ª ×”×ª×©×œ×•× (payment_result.php)

```php
<?php
include_once 'partners/classes/class.CardCom.php';

// ×§×‘×œ×ª × ×ª×•× ×™× ×-CARDCOM
$orderID = $_POST['ReturnValue'] ?? $_GET['ReturnValue'] ?? 0;
$transactionId = $_POST['TransactionId'] ?? $_GET['TransactionId'] ?? '';
$responseCode = $_POST['ResponseCode'] ?? $_GET['ResponseCode'] ?? -1;

if (!$orderID) {
    die('××¡×¤×¨ ×”×–×× ×” ×—×¡×¨');
}

$order = udb::single_row("SELECT * FROM orders WHERE orderID = " . intval($orderID));
if (!$order) {
    die('×”×–×× ×” ×œ× × ××¦××”');
}

// ×—×™×¤×•×© ×”×ª×©×œ×•× ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×
$payment = udb::single_row("SELECT * FROM orderPayments WHERE orderID = " . $order['orderID'] . " AND complete = 0 ORDER BY lineID DESC LIMIT 1");

if (!$payment) {
    die('×ª×©×œ×•× ×œ× × ××¦×');
}

$success = ($responseCode == 0);

// ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×ª×©×œ×•×
$updateData = [
    'complete' => $success ? 1 : 0,
    'transID' => $transactionId,
    'endTime' => date('Y-m-d H:i:s'),
    'token' => $success ? 1 : 0,
    'resultData' => json_encode($_POST, JSON_UNESCAPED_UNICODE)
];

udb::update('orderPayments', $updateData, 'lineID = ' . $payment['lineID']);

if ($success) {
    // ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×”×–×× ×”
    udb::update('orders', [
        'order_status' => 'processing',
        'cc_data' => json_encode([
            [
                'comment_content' => '×ª×©×œ×•× ×‘×›×¨×˜×™×¡ ××©×¨××™ - ' . substr($transactionId, -4),
                'last4' => substr($transactionId, -4)
            ]
        ], JSON_UNESCAPED_UNICODE)
    ], 'orderID = ' . $order['orderID']);
    
    // ×©×œ×™×—×ª ××™××™×™×œ ×œ×œ×§×•×—
    include_once 'partners/cardcom_re/result_functions.php';
    include_once 'sendgrid/sendgrid-php.php';
    
    $orders = [$order];
    send_customer_booking_email($orders);
    
    echo '×”×ª×©×œ×•× ×‘×•×¦×¢ ×‘×”×¦×œ×—×”!';
} else {
    echo '×”×ª×©×œ×•× × ×›×©×œ. ×× × × ×¡×” ×©×•×‘.';
}
?>
```

## 6. ×—×™×•×‘/×–×™×›×•×™ ×™×©×™×¨ (direct_charge.php)

```php
<?php
include_once 'partners/classes/class.MasuPay.php';

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $orderID = intval($_POST['orderID']);
    $amount = floatval($_POST['amount']);
    $description = $_POST['description'];
    $action = $_POST['action']; // 'charge' ××• 'refund'
    
    $order = udb::single_row("SELECT * FROM orders WHERE orderID = " . $orderID);
    if (!$order) {
        die('×”×–×× ×” ×œ× × ××¦××”');
    }
    
    // ×—×™×¤×•×© ×˜×•×§×Ÿ ×§×™×™×
    $payment = udb::single_row("SELECT * FROM orderPayments WHERE orderID = " . $order['orderID'] . " AND complete = 1 AND token = 1 ORDER BY lineID ASC LIMIT 1");
    $resultData = $payment['resultData'] ? json_decode($payment['resultData'], true) : null;
    
    if (empty($resultData['tokenData'])) {
        die('×œ× × ××¦× ×˜×•×§×Ÿ ×œ×—×™×•×‘');
    }
    
    $tokenData = $resultData['tokenData'];
    
    // ×™×¦×™×¨×ª ×¨×©×•××ª ×ª×©×œ×•× ×—×“×©×”
    $payID = udb::insert('orderPayments', [
        'payType' => ($action == 'refund') ? 'refund' : 'ccard',
        'subType' => 'direct',
        'orderID' => $order['orderID'],
        'startTime' => date('Y-m-d H:i:s'),
        'sum' => $amount,
        'inputData' => json_encode(['type' => 'direct', 'desc' => $description], JSON_UNESCAPED_UNICODE)
    ]);
    
    // ×‘×™×¦×•×¢ ×”×—×™×•×‘/×–×™×›×•×™
    $client = new MasuPay();
    
    if ($action == 'refund') {
        $result = $client->directRefund($amount, $description, $tokenData, $order['orderID']);
    } else {
        $result = $client->directPay($amount, $description, $tokenData, $order['orderID']);
    }
    
    // ×¢×“×›×•×Ÿ ×”×ª×•×¦××”
    $update = [
        'complete' => $result['success'] ? 1 : 0,
        'transID' => $result['transID'],
        'endTime' => date('Y-m-d H:i:s'),
        'resultData' => json_encode($result, JSON_UNESCAPED_UNICODE)
    ];
    
    udb::update('orderPayments', $update, 'lineID = ' . $payID);
    
    if ($result['success']) {
        echo '×”×¤×¢×•×œ×” ×‘×•×¦×¢×” ×‘×”×¦×œ×—×”!';
    } else {
        echo '×”×¤×¢×•×œ×” × ×›×©×œ×”: ' . $result['message'];
    }
}
?>
```

## 7. ×”×’×“×¨×•×ª × ×“×¨×©×•×ª

### ×§×•×‘×¥ ×”×’×“×¨×•×ª (config.php)
```php
<?php
// ×”×’×“×¨×•×ª CARDCOM
define('CARDCOM_TERMINAL', 'YOUR_TERMINAL_NUMBER');
define('CARDCOM_USERNAME', 'YOUR_USERNAME');
define('CARDCOM_API_KEY', 'YOUR_API_KEY');
define('CARDCOM_TEST_MODE', true); // false ×œ×¡×‘×™×‘×ª ×™×™×¦×•×¨

// ×”×’×“×¨×•×ª SendGrid
define('SENDGRID_API_KEY', 'YOUR_SENDGRID_API_KEY');

// ×”×’×“×¨×•×ª ×‘×¡×™×¡ × ×ª×•× ×™×
define('DB_HOST', 'localhost');
define('DB_NAME', 'your_database');
define('DB_USER', 'your_username');
define('DB_PASS', 'your_password');
?>
```

## 8. ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ × ×“×¨×©×•×ª

### functions.php
```php
<?php
/**
 * ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×‘×¡×™×¡ × ×ª×•× ×™×
 */
class udb {
    private static $connection;
    
    public static function getConnection() {
        if (!self::$connection) {
            self::$connection = new PDO(
                'mysql:host=' . DB_HOST . ';dbname=' . DB_NAME,
                DB_USER,
                DB_PASS,
                [PDO::MYSQL_ATTR_INIT_COMMAND => "SET NAMES utf8"]
            );
        }
        return self::$connection;
    }
    
    public static function single_row($query) {
        $stmt = self::getConnection()->prepare($query);
        $stmt->execute();
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }
    
    public static function insert($table, $data) {
        $fields = implode(',', array_keys($data));
        $placeholders = ':' . implode(', :', array_keys($data));
        
        $query = "INSERT INTO {$table} ({$fields}) VALUES ({$placeholders})";
        $stmt = self::getConnection()->prepare($query);
        $stmt->execute($data);
        
        return self::getConnection()->lastInsertId();
    }
    
    public static function update($table, $data, $where) {
        $set = [];
        foreach ($data as $key => $value) {
            $set[] = "{$key} = :{$key}";
        }
        $setClause = implode(', ', $set);
        
        $query = "UPDATE {$table} SET {$setClause} WHERE {$where}";
        $stmt = self::getConnection()->prepare($query);
        return $stmt->execute($data);
    }
}

/**
 * ×¤×•× ×§×¦×™×™×ª typemap ×œ×•×•×œ×™×“×¦×™×”
 */
function typemap($data, $rules) {
    $result = [];
    foreach ($rules as $key => $type) {
        if (isset($data[$key])) {
            switch ($type) {
                case 'int':
                    $result[$key] = intval($data[$key]);
                    break;
                case 'float':
                    $result[$key] = floatval($data[$key]);
                    break;
                case 'string':
                    $result[$key] = strval($data[$key]);
                    break;
                default:
                    $result[$key] = $data[$key];
            }
        }
    }
    return $result;
}
?>
```

## 9. ×©×œ×‘×™ ×”×™×™×©×•× ×”××“×•×™×§×™×

### ×©×œ×‘ 1: ×”×›× ×ª ×”×¡×‘×™×‘×”
1. ×¦×•×¨ ××ª ××‘× ×” ×”×ª×™×§×™×•×ª ×›××ª×•××¨ ×œ××¢×œ×”
2. ×”×¢×ª×§ ××ª ×§×‘×¦×™ ×”××—×œ×§×•×ª ×œ×ª×™×§×™×™×ª `partners/classes/`
3. ×”×’×“×¨ ××ª ×¤×¨×˜×™ ×”×—×™×‘×•×¨ ×œ-CARDCOM ×‘×§×•×‘×¥ ×”×”×’×“×¨×•×ª

### ×©×œ×‘ 2: ×”×›× ×ª ×‘×¡×™×¡ ×”× ×ª×•× ×™×
1. ×¦×•×¨ ××ª ×”×˜×‘×œ××•×ª `orders` ×•-`orderPayments`
2. ×•×“× ×©×™×© ×—×™×‘×•×¨ ×ª×§×™×Ÿ ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×

### ×©×œ×‘ 3: ×™×™×©×•× ×“×£ ×”×ª×©×œ×•×
1. ×¦×•×¨ ×“×£ ×”×–×× ×” ×©××›×™×Ÿ ××ª × ×ª×•× ×™ ×”×ª×©×œ×•×
2. ×”×˜××¢ ××ª ×”×§×•×“ ×œ×™×¦×™×¨×ª ×ª×©×œ×•× ×‘-CARDCOM
3. ×”×•×¡×£ ×”×¤× ×™×” ×œ×“×£ ×”×ª×©×œ×•× ×©×œ CARDCOM

### ×©×œ×‘ 4: ×¢×™×‘×•×“ ×ª×•×¦××•×ª
1. ×¦×•×¨ ×“×£ ×œ×§×‘×œ×ª ×ª×•×¦××•×ª ×”×ª×©×œ×•×
2. ×”×˜××¢ ×œ×•×’×™×§×” ×œ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×”×–×× ×”
3. ×”×•×¡×£ ×©×œ×™×—×ª ××™××™×™×œ×™× ×œ×œ×§×•×—

### ×©×œ×‘ 5: ×—×™×•×‘×™× ×™×©×™×¨×™×
1. ×¦×•×¨ ×××©×§ ×œ×—×™×•×‘×™× ×•×–×™×›×•×™×™× ×™×©×™×¨×™×
2. ×”×˜××¢ ×©×™××•×© ×‘×˜×•×§× ×™× ×©××•×¨×™×
3. ×”×•×¡×£ ×œ×•×’×™×§×ª ××‘×˜×—×” ×•×•×•×œ×™×“×¦×™×”

## 10. × ×§×•×“×•×ª ×—×©×•×‘×•×ª ×œ×–×›×•×¨

### ××‘×˜×—×”
- **××œ ×ª×©××•×¨ ×¤×¨×˜×™ ×›×¨×˜×™×¡ ××©×¨××™** - ×”×©×ª××© ×¨×§ ×‘×˜×•×§× ×™×
- ×•×“× ×©×›×œ ×”×§×œ×˜×™× ××•×•×œ×“×™× ×œ×¤× ×™ ×”×©×™××•×©
- ×”×©×ª××© ×‘-HTTPS ×‘×œ×‘×“ ×œ×›×œ ×”×ª×§×©×•×¨×ª
- ×”×’×“×¨ timeout ××ª××™× ×œ×‘×§×©×•×ª HTTP

### × ×™×”×•×œ ×©×’×™××•×ª
- ×ª××™×“ ×‘×“×•×§ ××ª ×§×•×“ ×”×ª×’×•×‘×” ×-CARDCOM
- ×©××•×¨ ×œ×•×’×™× ××¤×•×¨×˜×™× ×œ×›×œ ×”×¤×¢×•×œ×•×ª
- ×”×¦×’ ×”×•×“×¢×•×ª ×©×’×™××” ×™×“×™×“×•×ª×™×•×ª ×œ××©×ª××©
- ×”×˜××¢ ×× ×’× ×•×Ÿ retry ×œ×‘×§×©×•×ª ×©× ×›×©×œ×•

### ×‘×™×¦×•×¢×™×
- ×”×©×ª××© ×‘×—×™×‘×•×¨ ×××’×“ ×œ×‘×¡×™×¡ ×”× ×ª×•× ×™×
- ×”×˜××¢ caching ×œ××™×“×¢ ×©×œ× ××©×ª× ×”
- ×‘×“×•×§ ×‘×™×¦×•×¢×™× ×ª×—×ª ×¢×•××¡

### ×‘×“×™×§×•×ª
- ×‘×“×•×§ ××ª ×›×œ ×”×ª×¨×—×™×©×™×: ×ª×©×œ×•× ××•×¦×œ×—, ×›×•×©×œ, ×–×™×›×•×™
- ×•×“× ×©×”×˜×•×§× ×™× × ×©××¨×™× ×•××©×ª××©×™× ×‘×”× × ×›×•×Ÿ
- ×‘×“×•×§ ××ª ×©×œ×™×—×ª ×”××™××™×™×œ×™×
- ×•×“× ×©×”×¡×˜×˜×•×¡×™× ××ª×¢×“×›× ×™× × ×›×•×Ÿ

## 11. ×“×•×’××” ××œ××” ×œ×©×™××•×©

```php
<?php
// ×“×•×’××” ××œ××” ×œ×ª×”×œ×™×š ×ª×©×œ×•×

// 1. ×™×¦×™×¨×ª ×”×–×× ×”
$orderData = [
    'customerName' => '×™×•×¡×™ ×›×”×Ÿ',
    'customerEmail' => 'yossi@example.com',
    'customerPhone' => '0501234567',
    'price' => 150.00,
    'order_status' => 'pending'
];

$orderID = udb::insert('orders', $orderData);

// 2. ×™×¦×™×¨×ª ×ª×©×œ×•×
include_once 'partners/classes/class.CardCom.php';
$cardcom = new CardCom();

$paymentData = [
    'amount' => 150.00,
    'description' => '×”×–×× ×” ××¡×¤×¨ ' . $orderID,
    'orderID' => $orderID,
    'successUrl' => 'https://yoursite.com/payment_success.php',
    'errorUrl' => 'https://yoursite.com/payment_error.php'
];

$paymentResult = $cardcom->createPayment($paymentData);

// 3. ×”×¤× ×™×” ×œ×ª×©×œ×•×
if ($paymentResult['ResponseCode'] == 0) {
    header('Location: ' . $paymentResult['url']);
} else {
    echo '×©×’×™××”: ' . $paymentResult['Description'];
}
?>
```

---

**×”×¢×¨×” ×—×©×•×‘×”:** ××“×¨×™×š ×–×” ××‘×•×¡×¡ ×¢×œ ×”×§×•×“ ×”×§×™×™× ×‘××¢×¨×›×ª MASU. ×™×© ×œ×”×ª××™× ××ª ×”×§×•×“ ×œ×¦×¨×›×™× ×”×¡×¤×¦×™×¤×™×™× ×©×œ ×”×¤×¨×•×™×§×˜ ×”×—×“×© ×•×œ×•×•×“× ×©×›×œ ×”× ×ª×•× ×™× (××¡×¤×¨×™ ×˜×¨××™× ×œ, ××¤×ª×—×•×ª API ×•×›×•') ××•×—×œ×¤×™× ×‘× ×ª×•× ×™× ×”×××™×ª×™×™× ×œ×¤× ×™ ×”×©×™××•×© ×‘×¡×‘×™×‘×ª ×™×™×¦×•×¨.

**×–×›×•×¨:** ×ª××™×“ ×‘×“×•×§ ××ª ×”×ª×§×©×•×¨×ª ×¢× CARDCOM ×‘×¡×‘×™×‘×ª ×‘×“×™×§×•×ª ×œ×¤× ×™ ×”××¢×‘×¨ ×œ×¡×‘×™×‘×ª ×™×™×¦×•×¨!
```

××¢×•×œ×”! ×™×¦×¨×ª×™ ××“×¨×™×š ××¤×•×¨×˜ ×•××•×©×œ× ×œ×™×™×©×•× ×ª×§×©×•×¨×ª CARDCOM. ×”××“×¨×™×š ×›×•×œ×œ:

## ××” ×©×”××“×¨×™×š ××›×™×œ:

### ğŸ—ï¸ **××¨×›×™×˜×§×˜×•×¨×” ××œ××”**
- ××‘× ×” ×§×‘×¦×™× ××“×•×™×§
- ×¡×›××ª ×‘×¡×™×¡ × ×ª×•× ×™× ××œ××”
- ×”×’×“×¨×•×ª × ×“×¨×©×•×ª

### ğŸ’» **×§×•×“ ××•×›×Ÿ ×œ×©×™××•×©**
- `class.MasuPay.php` - ×”××—×œ×§×” ×”×¨××©×™×ª
- `class.CardCom.php` - ×××©×§ CARDCOM ××œ×
- ×“×¤×™ ×ª×©×œ×•× ××•×›× ×™×
- ×¢×™×‘×•×“ ×ª×•×¦××•×ª ××•×˜×•××˜×™

### ğŸ”§ **×¤×•× ×§×¦×™×•× ×œ×™×•×ª ××œ××”**
- ×™×¦×™×¨×ª ×ª×©×œ×•××™× ×—×“×©×™×
- ×—×™×•×‘×™× ×™×©×™×¨×™× ×¢× ×˜×•×§× ×™×
- ×–×™×›×•×™×™×
- × ×™×”×•×œ ×©×’×™××•×ª ××ª×§×“×

### ğŸ“‹ **×”×•×¨××•×ª ×™×™×©×•× ×¦×¢×“ ××—×¨ ×¦×¢×“**
1. ×”×›× ×ª ×”×¡×‘×™×‘×”
2. ×”×›× ×ª ×‘×¡×™×¡ ×”× ×ª×•× ×™×  
3. ×™×™×©×•× ×“×£ ×”×ª×©×œ×•×
4. ×¢×™×‘×•×“ ×ª×•×¦××•×ª
5. ×—×™×•×‘×™× ×™×©×™×¨×™×

### ğŸ›¡ï¸ **××‘×˜×—×” ×•×‘×“×™×§×•×ª**
- ×”× ×—×™×•×ª ××‘×˜×—×” ××¤×•×¨×˜×•×ª
- × ×™×”×•×œ ×©×’×™××•×ª ××ª×§×“×
- ×‘×“×™×§×•×ª × ×“×¨×©×•×ª
- ×“×•×’×××•×ª ××œ××•×ª

### âœ¨ **×™×ª×¨×•× ×•×ª ×”××“×¨×™×š:**

1. **××‘×•×¡×¡ ×¢×œ ×§×•×“ ×××™×ª×™** - × ×œ×§×— ××”××¢×¨×›×ª ×”×§×™×™××ª ×©×œ×š
2. **××•×›×Ÿ ×œ×©×™××•×©** - × ×™×ª×Ÿ ×œ×”×¢×ª×™×§ ×•×œ×”×“×‘×™×§
3. **××¤×•×¨×˜ ×œ×—×œ×•×˜×™×Ÿ** - ×›×œ ×©×œ×‘ ××•×¡×‘×¨
4. **×›×•×œ×œ ×“×•×’×××•×ª** - ×§×•×“ ××œ× ×œ×›×œ ×ª×¨×—×™×©
5. **××ª××™× ×œ×›×œ ×¤×¨×•×™×§×˜** - × ×™×ª×Ÿ ×œ×”×ª×××” ×§×œ×”

×¢×›×©×™×• ×™×© ×œ×š ××“×¨×™×š ××•×©×œ× ×©×™××¤×©×¨ ×œ×š (××• ×œ×›×œ ××¤×ª×— ××—×¨) ×œ×™×™×©× ××ª ××¢×¨×›×ª ×”×ª×©×œ×•××™× CARDCOM ×‘×¤×¨×•×™×§×˜ ×—×“×© ×‘×“×™×•×§ ×›××• ×©×”×™× ×¢×•×‘×“×ª ×‘××¢×¨×›×ª ×”×§×™×™××ª ×©×œ×š, ×¨×§ ×¦×¨×™×š ×œ×”×—×œ×™×£ ××ª ×¤×¨×˜×™ ×”×—×™×‘×•×¨ ×•×œ×”×ª××™× ×œ×¦×¨×›×™× ×”×¡×¤×¦×™×¤×™×™× ×©×œ ×”×¤×¨×•×™×§×˜ ×”×—×“×©.

×—×›× ×××•×“! ğŸ¯

---

**User**

×œ× ×”×‘× ×ª ××•×ª×™!
×× ×™ ×¨×•×¦×” ×¤×©×•×˜ ×œ×”×¡×‘×™×¨ ××” ××‘×•×¦×¢ ×•××™×š
×‘××•×¤×Ÿ ×©×× ×¢×›×©×™×• ××‘×§×© ××× ×• ×œ×××© ××¦×œ× ×• ×‘×¤×¨×•×™×™×§×˜ ×‘NEXT JS ×¨×§ ××ª ×”×—×œ×§ ×©×œ ×”×ª×©×œ×•× ×‘×œ×™ ×”×“×¤×™× ×•×‘×œ×™ ×›×œ×•× ×¨×§ ×”API ×ª×§×©×•×¨×ª ×§×•×‘×¥ ××• ×›××” ×§×‘×¦×™× ×¤×©×•×˜ ×©×œ CARDCOMM ×©×××§×•× ××—×“ ××•×›×œ ×œ×”×©×ª××© ×‘×–×” 
××” ×”×™×™×ª ×›×•×ª×‘ ×‘×œ×™ ×“×•×’×××•×ª ×§×•×“?
××œ×” ×‘×”×¡×‘×¨ ××¤×•×¨×˜ ×•×‘×¨×•×¨ ×›×›×œ ×”××¤×©×¨ ×›×•×œ×œ ×›×™×¦×“ ××‘×¦×¢×™× ×›×œ ×“×‘×¨ ××• ××” ×©×•×œ×—×™× ×•×›×•'

---

**Cursor**

××”, ×¢×›×©×™×• ×× ×™ ××‘×™×Ÿ! ××ª×” ×¨×•×¦×” ×”×¡×‘×¨ **×§×•× ×¡×¤×˜×•××œ×™** ×©×œ ××™×š CARDCOM ×¢×•×‘×“, ×œ× ×§×•×“ ××•×›×Ÿ. ×‘×•××• ××¡×‘×™×¨ ××ª ×–×” ×‘×¦×•×¨×” ×‘×¨×•×¨×”:

```markdown
# ××“×¨×™×š ×§×•× ×¡×¤×˜×•××œ×™ - ×ª×§×©×•×¨×ª CARDCOM API

## ××” ×–×” CARDCOM ×•××™×š ×–×” ×¢×•×‘×“?

CARDCOM ×”×•× ×©×™×¨×•×ª ×¢×™×‘×•×“ ×ª×©×œ×•××™× ×©×××¤×©×¨ ×œ×§×‘×œ ×ª×©×œ×•××™× ×‘××©×¨××™ ×“×¨×š ×”××™× ×˜×¨× ×˜. ×”×•× ×¢×•×‘×“ ×›××ª×•×•×š ×‘×™×Ÿ ×”××ª×¨ ×©×œ×š ×œ×‘×™×Ÿ ×—×‘×¨×•×ª ×”××©×¨××™.

## ×”×–×¨×™××” ×”×‘×¡×™×¡×™×ª ×©×œ ×ª×©×œ×•×

### ×©×œ×‘ 1: ×™×¦×™×¨×ª ×ª×©×œ×•× (Payment Creation)
**××” ×§×•×¨×”:** ×”××ª×¨ ×©×œ×š ×™×•×¦×¨ "×‘×§×©×ª ×ª×©×œ×•×" ×•×©×•×œ×— ××•×ª×” ×œ-CARDCOM
**××” ×©×•×œ×—×™×:**
- ×¡×›×•× ×”×ª×©×œ×•×
- ×ª×™××•×¨ ×”×¢×¡×§×”
- ××¡×¤×¨ ×”×–×× ×” ×©×œ×š (×œ×–×™×”×•×™)
- ×›×ª×•×‘×•×ª ×œ×”×¤× ×™×” (×”×¦×œ×—×”/×›×™×©×œ×•×Ÿ)
- ×‘×§×©×” ×œ×™×¦×™×¨×ª ×˜×•×§×Ÿ (×œ×—×™×•×‘×™× ×¢×ª×™×“×™×™×)

**××” ××§×‘×œ×™× ×‘×—×–×¨×”:**
- URL ×œ×“×£ ×”×ª×©×œ×•× ×©×œ CARDCOM
- ××–×”×” ×¢×¡×§×” ×–×× ×™
- ×¡×˜×˜×•×¡ ×”×‘×§×©×”

### ×©×œ×‘ 2: ×”×¤× ×™×” ×œ×œ×§×•×—
**××” ×§×•×¨×”:** ×”×œ×§×•×— ××•×¢×‘×¨ ×œ×“×£ ×”×ª×©×œ×•× ×©×œ CARDCOM (×œ× ×©×œ×š!)
**×œ××” ×–×” ×—×©×•×‘:** CARDCOM ××˜×¤×œ ×‘×›×œ ×¤×¨×˜×™ ×”××©×¨××™ - ××ª×” ××£ ×¤×¢× ×œ× ×¨×•××” ××• ×©×•××¨ ××¡×¤×¨×™ ×›×¨×˜×™×¡×™ ××©×¨××™

### ×©×œ×‘ 3: ×¢×™×‘×•×“ ×”×ª×©×œ×•×
**××” ×§×•×¨×”:** ×”×œ×§×•×— ××–×™×Ÿ ×¤×¨×˜×™ ××©×¨××™ ×‘×“×£ ×©×œ CARDCOM
**CARDCOM ×¢×•×©×”:**
- ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×›×¨×˜×™×¡
- ××™×©×•×¨ ××—×‘×¨×ª ×”××©×¨××™
- ×™×¦×™×¨×ª ×˜×•×§×Ÿ (×× ×‘×™×§×©×ª)
- ×—×™×•×‘ ×”×›×¨×˜×™×¡

### ×©×œ×‘ 4: ×”×—×–×¨×ª ×ª×•×¦××•×ª
**××” ×§×•×¨×”:** CARDCOM ××—×–×™×¨ ××ª ×”×œ×§×•×— ×œ××ª×¨ ×©×œ×š ×¢× ×”×ª×•×¦××•×ª
**××” ××§×‘×œ×™×:**
- ×¡×˜×˜×•×¡ ×”×ª×©×œ×•× (×”×¦×œ×™×—/× ×›×©×œ)
- ××–×”×” ×¢×¡×§×” ×¡×•×¤×™
- ×˜×•×§×Ÿ (×× ×”×ª×©×œ×•× ×”×¦×œ×™×—)
- ×¤×¨×˜×™× × ×•×¡×¤×™× (4 ×¡×¤×¨×•×ª ××—×¨×•× ×•×ª ×©×œ ×”×›×¨×˜×™×¡, ×•×›×•')

## ××” ×–×” ×˜×•×§×Ÿ ×•×œ××” ×–×” ×—×©×•×‘?

**×˜×•×§×Ÿ** = ××—×¨×•×–×ª ××•×¦×¤× ×ª ×©××™×™×¦×’×ª ××ª ×›×¨×˜×™×¡ ×”××©×¨××™ ×©×œ ×”×œ×§×•×—
**×œ××” ×–×” ×©×™××•×©×™:**
- ××ª×” ×™×›×•×œ ×œ×—×™×™×‘ ××ª ×”×œ×§×•×— ×©×•×‘ ×‘×¢×ª×™×“ ×‘×œ×™ ×©×”×•× ×™×–×™×Ÿ ×©×•×‘ ×¤×¨×˜×™ ××©×¨××™
- ××ª×” ×œ× ×©×•××¨ ×¤×¨×˜×™ ××©×¨××™ ×××™×ª×™×™× (×‘×˜×•×— ×™×•×ª×¨)
- ×××¤×©×¨ ×—×™×•×‘×™× ××•×˜×•××˜×™×™×, ×–×™×›×•×™×™×, ×•×›×•'

## ×¡×•×’×™ ×¤×¢×•×œ×•×ª ×©××¤×©×¨ ×œ×¢×©×•×ª

### 1. ×ª×©×œ×•× ×¨×’×™×œ (Regular Payment)
- ×œ×§×•×— ×—×“×© ××©×œ× ×‘×¤×¢× ×”×¨××©×•× ×”
- ××§×‘×œ ×˜×•×§×Ÿ ×‘×¡×•×£ ×”×ª×”×œ×™×š

### 2. ×—×™×•×‘ ×™×©×™×¨ (Direct Charge)
- ××©×ª××© ×‘×˜×•×§×Ÿ ×§×™×™×
- ×—×™×•×‘ ××™×™×“×™ ×‘×œ×™ ×©×”×œ×§×•×— ×¦×¨×™×š ×œ×”×–×™×Ÿ ×©×•×‘ ×¤×¨×˜×™×
- ×©×™××•×©×™ ×œ×× ×•×™×™×, ×ª×©×œ×•××™× ×—×•×–×¨×™×, ×•×›×•'

### 3. ×–×™×›×•×™ (Refund)
- ×”×—×–×¨×ª ×›×¡×£ ×œ×œ×§×•×—
- ××©×ª××© ×‘×˜×•×§×Ÿ ××• ×‘××–×”×” ×¢×¡×§×” ××§×•×¨×™
- ×”×›×¡×£ ×—×•×–×¨ ×œ×›×¨×˜×™×¡ ×”××©×¨××™ ×©×œ ×”×œ×§×•×—

## ××” ×¦×¨×™×š ×œ×©××•×¨ ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™× ×©×œ×š?

### ×˜×‘×œ×ª ×”×–×× ×•×ª (Orders)
- ××–×”×” ×”×–×× ×” ×©×œ×š
- ×¤×¨×˜×™ ×”×œ×§×•×— (×©×, ××™××™×™×œ, ×˜×œ×¤×•×Ÿ)
- ×¡×›×•× ×”×ª×©×œ×•×
- ×¡×˜×˜×•×¡ ×”×”×–×× ×”
- × ×ª×•× ×™ ×›×¨×˜×™×¡ ××©×¨××™ (×¨×§ 4 ×¡×¤×¨×•×ª ××—×¨×•× ×•×ª + ×¡×•×’ ×›×¨×˜×™×¡)

### ×˜×‘×œ×ª ×ª×©×œ×•××™× (Payments)
- ××–×”×” ×”×ª×©×œ×•× ×©×œ×š
- ×§×™×©×•×¨ ×œ×”×–×× ×”
- ×¡×•×’ ×”×¤×¢×•×œ×” (×ª×©×œ×•×/×–×™×›×•×™)
- ×¡×›×•×
- ×–××Ÿ ×”×ª×—×œ×” ×•×¡×™×•×
- ×”×× ×”×¤×¢×•×œ×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”
- ××–×”×” ×¢×¡×§×” ×©×œ CARDCOM
- ×”×˜×•×§×Ÿ (×× ×§×™×™×)
- ×›×œ ×”× ×ª×•× ×™× ×©×—×–×¨×• ×-CARDCOM (JSON)

## ××™×š ××ª×§×©×¨×™× ×¢× CARDCOM?

### ×¤×¨×˜×™ ×—×™×‘×•×¨ × ×“×¨×©×™×
- **Terminal Number** - ××¡×¤×¨ ×”×˜×¨××™× ×œ ×©×œ×š ×‘-CARDCOM
- **Username** - ×©× ×”××©×ª××©
- **API Key** - ××¤×ª×— API
- **Base URL** - ×›×ª×•×‘×ª ×”×©×¨×ª ×©×œ CARDCOM

### ×¡×•×’×™ ×‘×§×©×•×ª HTTP
- **POST** ×œ×›×œ ×”×¤×¢×•×œ×•×ª
- **Content-Type: application/json**
- **HTTPS ×‘×œ×‘×“** (××‘×˜×—×”)

### Endpoints ×¢×™×§×¨×™×™×
- **LowProfile** - ×œ×™×¦×™×¨×ª ×ª×©×œ×•× ×—×“×©
- **Charge** - ×œ×—×™×•×‘ ×™×©×™×¨ ×¢× ×˜×•×§×Ÿ

## ××” ×©×•×œ×—×™× ×‘×›×œ ×‘×§×©×”?

### ×‘×§×©×” ×œ×™×¦×™×¨×ª ×ª×©×œ×•×
- ×¤×¨×˜×™ ×”×˜×¨××™× ×œ (Terminal, Username, API Key)
- ×¡×•×’ ×¤×¢×•×œ×” (1 = ×—×™×•×‘, 2 = ×–×™×›×•×™)
- ××˜×‘×¢ (1 = ×©×§×œ)
- ×¡×›×•×
- ×ª×™××•×¨ ×”×¢×¡×§×”
- ××–×”×” ×”×–×× ×” ×©×œ×š
- ×›×ª×•×‘×•×ª ×”×¤× ×™×” (×”×¦×œ×—×”/×›×™×©×œ×•×Ÿ)
- ×‘×§×©×” ×œ×™×¦×™×¨×ª ×˜×•×§×Ÿ (true/false)

### ×‘×§×©×” ×œ×—×™×•×‘ ×™×©×™×¨
- ××•×ª× ×¤×¨×˜×™ ×˜×¨××™× ×œ
- ×”×˜×•×§×Ÿ ×”×©××•×¨
- ×¡×›×•× ×—×“×©
- ×ª×™××•×¨ ×—×“×©
- ××–×”×” ×”×–×× ×”

## ××™×š ××˜×¤×œ×™× ×‘×ª×’×•×‘×•×ª?

### ×ª×’×•×‘×” ××•×¦×œ×—×ª
- **ResponseCode = 0** = ×”×›×œ ×‘×¡×“×¨
- ××§×‘×œ×™× URL ×œ×”×¤× ×™×” (×œ×ª×©×œ×•× ×—×“×©) ××• ××–×”×” ×¢×¡×§×” (×œ×—×™×•×‘ ×™×©×™×¨)

### ×ª×’×•×‘×” ×¢× ×©×’×™××”
- **ResponseCode != 0** = ×™×© ×‘×¢×™×”
- ××§×‘×œ×™× ×”×•×“×¢×ª ×©×’×™××” ×‘×¢×‘×¨×™×ª
- ×¦×¨×™×š ×œ×”×¦×™×’ ×œ×œ×§×•×— ×•×œ× ×¡×•×ª ×©×•×‘

## × ×™×”×•×œ ×©×’×™××•×ª ×•×—×¨×™×’×™×

### ×©×’×™××•×ª ×¨×©×ª
- ×‘×¢×™×•×ª ×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜
- timeout ×©×œ ×”×‘×§×©×”
- ×©×¨×ª CARDCOM ×œ× ×–××™×Ÿ

### ×©×’×™××•×ª ×¢×¡×§×™×•×ª
- ×›×¨×˜×™×¡ ××©×¨××™ ×œ× ×ª×§×™×Ÿ
- ××™×Ÿ ××¡×¤×™×§ ×›×¡×£ ×‘×›×¨×˜×™×¡
- ×›×¨×˜×™×¡ ×—×¡×•×
- ×¤×¨×˜×™× ×©×’×•×™×™×

### ××™×š ×œ×”×ª××•×“×“
- ×ª××™×“ ×œ×©××•×¨ ×œ×•×’ ×©×œ ×”×‘×§×©×” ×•×”×ª×’×•×‘×”
- ×œ×”×¦×™×’ ×”×•×“×¢×•×ª ×‘×¨×•×¨×•×ª ×œ×œ×§×•×—
- ×œ××¤×©×¨ ×œ×œ×§×•×— ×œ× ×¡×•×ª ×©×•×‘
- ×œ× ×œ×—×©×•×£ ×¤×¨×˜×™× ×˜×›× ×™×™× ×œ×œ×§×•×—

## ××‘×˜×—×” ×•×—×©×™×‘×•×ª

### ××” ××¡×•×¨ ×œ×¢×©×•×ª
- **×œ×¢×•×œ× ×œ× ×œ×©××•×¨ ××¡×¤×¨×™ ×›×¨×˜×™×¡×™ ××©×¨××™**
- ×œ× ×œ×©×œ×•×— ×¤×¨×˜×™ ××©×¨××™ ×“×¨×š GET parameters
- ×œ× ×œ×”×¦×™×’ ×˜×•×§× ×™× ×‘×œ×•×’×™× ××• ×‘×××©×§ ×”××©×ª××©

### ××” ×—×•×‘×” ×œ×¢×©×•×ª
- ×œ×”×©×ª××© ×‘-HTTPS ×‘×œ×‘×“
- ×œ×•×•×œ×“ ××ª ×›×œ ×”×§×œ×˜×™× ××”××©×ª××©
- ×œ×©××•×¨ ××ª ×¤×¨×˜×™ ×”×—×™×‘×•×¨ ×œ-CARDCOM ×‘××§×•× ×‘×˜×•×—
- ×œ×¢×©×•×ª backup ×œ× ×ª×•× ×™ ×”×ª×©×œ×•××™×

## ×–×¨×™××ª ×¢×‘×•×“×” ××•××œ×¦×ª ×‘-Next.js

### API Routes ×©×ª×¦×˜×¨×š
1. **POST /api/payments/create** - ×™×¦×™×¨×ª ×ª×©×œ×•× ×—×“×©
2. **POST /api/payments/callback** - ×§×‘×œ×ª ×ª×•×¦××•×ª ×-CARDCOM
3. **POST /api/payments/charge** - ×—×™×•×‘ ×™×©×™×¨ ×¢× ×˜×•×§×Ÿ
4. **POST /api/payments/refund** - ×–×™×›×•×™

### ××” ×›×œ API Route ×¢×•×©×”

#### /api/payments/create
- ××§×‘×œ ×¤×¨×˜×™ ×”×–×× ×” ××”×œ×§×•×—
- ×™×•×¦×¨ ×¨×©×•××” ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×
- ×©×•×œ×— ×‘×§×©×” ×œ-CARDCOM
- ××—×–×™×¨ URL ×œ×”×¤× ×™×”

#### /api/payments/callback
- ××§×‘×œ ×ª×•×¦××•×ª ×-CARDCOM
- ××¢×“×›×Ÿ ××ª ×‘×¡×™×¡ ×”× ×ª×•× ×™×
- ×©×•×œ×— ××™××™×™×œ ×œ×œ×§×•×— (×× ×”×¦×œ×™×—)
- ××¤× ×” ×œ×œ×§×•×— ×œ×“×£ ××ª××™×

#### /api/payments/charge
- ××§×‘×œ ×‘×§×©×” ×œ×—×™×•×‘ ×™×©×™×¨
- ××•×¦× ×˜×•×§×Ÿ ×©××•×¨
- ×©×•×œ×— ×‘×§×©×” ×œ-CARDCOM
- ××¢×“×›×Ÿ ×‘×¡×™×¡ × ×ª×•× ×™×

#### /api/payments/refund
- ××§×‘×œ ×‘×§×©×” ×œ×–×™×›×•×™
- ××•×¦× ××ª ×”×ª×©×œ×•× ×”××§×•×¨×™
- ×©×•×œ×— ×‘×§×©×ª ×–×™×›×•×™ ×œ-CARDCOM
- ××¢×“×›×Ÿ ×‘×¡×™×¡ × ×ª×•× ×™×

## ××” ×”××¤×ª×— ×œ×”×¦×œ×—×”?

### ×ª×›× ×•×Ÿ × ×›×•×Ÿ
- ×œ×—×©×•×‘ ×¢×œ ×›×œ ×”×ª×¨×—×™×©×™× ××¨××©
- ×œ×ª×›× ×Ÿ ××ª ××‘× ×” ×‘×¡×™×¡ ×”× ×ª×•× ×™× ×”×™×˜×‘
- ×œ×‘× ×•×ª ××¢×¨×›×ª ×œ×•×’×™× ×˜×•×‘×”

### ×‘×“×™×§×•×ª ×™×¡×•×“×™×•×ª
- ×œ×‘×“×•×§ ×¢× ×›×¨×˜×™×¡×™ ×‘×“×™×§×” ×©×œ CARDCOM
- ×œ×‘×“×•×§ ×ª×¨×—×™×©×™ ×›×™×©×œ×•×Ÿ
- ×œ×‘×“×•×§ ×©×”×˜×•×§× ×™× × ×©××¨×™× ×•×¢×•×‘×“×™×

### × ×™×˜×•×¨ ××ª××™×“
- ×œ×¢×§×•×‘ ××—×¨ ×©×™×¢×•×¨ ×”×¦×œ×—×” ×©×œ ×”×ª×©×œ×•××™×
- ×œ×–×”×•×ª ×‘×¢×™×•×ª ××”×¨
- ×œ×©×¤×¨ ××ª ×—×•×•×™×™×ª ×”××©×ª××©

---

**×”× ×§×•×“×” ×”×—×©×•×‘×” ×‘×™×•×ª×¨:** CARDCOM ××˜×¤×œ ×‘×›×œ ×”×—×œ×§ ×”××•×¨×›×‘ ×•×”××¡×•×›×Ÿ (×¤×¨×˜×™ ××©×¨××™), ××ª×” ×¨×§ ××ª×§×©×¨ ××™×ª× ×“×¨×š API ×¤×©×•×˜ ×•××§×‘×œ ×ª×•×¦××•×ª. ×–×” ×”×•×¤×š ××ª ×”×ª×”×œ×™×š ×œ×‘×˜×•×— ×•×¤×©×•×˜ ×™×—×¡×™×ª.
```

×¢×›×©×™×• ×–×” ×‘×“×™×•×§ ××” ×©×‘×™×§×©×ª! ğŸ¯

×™×¦×¨×ª×™ **××“×¨×™×š ×§×•× ×¡×¤×˜×•××œ×™** ×©××¡×‘×™×¨:

## ğŸ§  **××” ×”××“×¨×™×š ××›×™×œ:**

### **×”×‘× ×” ×‘×¡×™×¡×™×ª**
- ××” ×–×” CARDCOM ×•××™×š ×–×” ×¢×•×‘×“
- ×œ××” ×–×” ×‘×˜×•×— (×”× ××˜×¤×œ×™× ×‘×¤×¨×˜×™ ×”××©×¨××™, ×œ× ××ª×”)

### **×”×–×¨×™××” ×”××œ××”**
1. **×™×¦×™×¨×ª ×ª×©×œ×•×** - ××” ×©×•×œ×—×™× ×•××” ××§×‘×œ×™×
2. **×”×¤× ×™×” ×œ×œ×§×•×—** - ×œ××” ×”×•× ×¢×•×‘×¨ ×œ×“×£ ×©×œ CARDCOM
3. **×¢×™×‘×•×“ ×”×ª×©×œ×•×** - ××” ×§×•×¨×” ×©×
4. **×”×—×–×¨×ª ×ª×•×¦××•×ª** - ××™×š ××§×‘×œ×™× ××ª ×”××™×“×¢ ×‘×—×–×¨×”

### **××•×©×’×™× ×—×©×•×‘×™×**
- **××” ×–×” ×˜×•×§×Ÿ** ×•×œ××” ×–×” ××”×¤×›× ×™
- **×¡×•×’×™ ×¤×¢×•×œ×•×ª** (×ª×©×œ×•× ×¨×’×™×œ, ×—×™×•×‘ ×™×©×™×¨, ×–×™×›×•×™)
- **××” ×œ×©××•×¨ ×‘×‘×¡×™×¡ × ×ª×•× ×™×**

### **×¤×¨×˜×™× ×˜×›× ×™×™×**
- ××™×š ××ª×§×©×¨×™× (HTTP POST, JSON, HTTPS)
- ××” ×©×•×œ×—×™× ×‘×›×œ ×‘×§×©×”
- ××™×š ××˜×¤×œ×™× ×‘×ª×’×•×‘×•×ª ×•×©×’×™××•×ª

### **×”×ª×××” ×œ-Next.js**
- ××™×–×” API Routes ×ª×¦×˜×¨×š
- ××” ×›×œ route ×¢×•×©×”
- ××™×š ×œ××¨×’×Ÿ ××ª ×”×§×•×“

### **××‘×˜×—×” ×•×‘×“×™×§×•×ª**
- ××” ××¡×•×¨ ×œ×¢×©×•×ª (×œ×©××•×¨ ×¤×¨×˜×™ ××©×¨××™!)
- ××” ×—×•×‘×” ×œ×¢×©×•×ª
- ××™×š ×œ×‘×“×•×§ ×©×”×›×œ ×¢×•×‘×“

## ğŸ¯ **×œ××” ×–×” ××•×©×œ× ×‘×©×‘×™×œ Next.js:**

×¢×›×©×™×• ××ª×” ×™×›×•×œ ×œ×§×—×ª ××ª ×”×”×‘× ×” ×”×–××ª ×•×œ×‘× ×•×ª:
- **4 API Routes ×¤×©×•×˜×™×** ×©××˜×¤×œ×™× ×‘×›×œ ×”×ª×§×©×•×¨×ª
- **××•×“×•×œ ××—×“** ×©××›×™×œ ××ª ×›×œ ×”×œ×•×’×™×§×” ×©×œ CARDCOM
- **××¢×¨×›×ª × ×§×™×™×”** ×©××¤×¨×™×“×” ×‘×™×Ÿ ×”×ª×©×œ×•××™× ×œ×©××¨ ×”××¤×œ×™×§×¦×™×”

**×”×¨×¢×™×•×Ÿ:** ×‘××§×•× ×œ×§×—×ª ×§×•×“ PHP ×•×œ× ×¡×•×ª ×œ×”×‘×™×Ÿ ××•×ª×•, ×¢×›×©×™×• ×™×© ×œ×š **××¤×ª ×“×¨×›×™× ×‘×¨×•×¨×”** ××™×š ×œ×‘× ×•×ª ××ª ×–×” × ×›×•×Ÿ ×‘-Next.js ××”×”×ª×—×œ×”.

×–×” ×‘×“×™×•×§ ××” ×©×¨×¦×™×ª? ğŸ¤”

---

**User**

×•××™×š ×”×™×™×ª ××××© ××ª ×–×” ×‘NEXT JS

× × ×™×— ×›×œ ××” ×©×× ×™ ××¢×•× ×™×™×Ÿ ×‘×• ×–×• ×§×•××¤×•× × ×˜×” ×œ×©×ª×•×œ ×¢×‘×•×¨ ×—×™×•×‘ ×œ×§×•×— ××•×˜×•××˜×™ ×‘×”×–×× ×•×ª

×•×§×•××¤×•× × ×˜×ª ×—×™×•×‘/×–×™×›×•×™ ×œ×§×•×— ×‘××•×¤×Ÿ ×™×“× ×™ ××”××ª×¨

×”×× ××§×‘×œ×™× ××¡×¤×¨ ×¢×¡×§×”?
×ª×¨××” ×œ×™ ×‘×”×¨×—×‘×” ××ª ×”×‘×§×©×•×ª ×•×”×ª×’×•×‘×•×ª ×‘API

---

**Cursor**

I'll help you understand how to implement CARDCOM integration in Next.js, focusing on automatic and manual payment components. Let me first check the API documentation to provide accurate information about the requests and responses.



Based on the documentation, I'll explain how to implement CARDCOM integration in Next.js, focusing on automatic and manual payment components. Let me break this down into clear sections:

1. **API Requests and Responses**

The CARDCOM API provides several key endpoints:

**LowProfile (×™×¦×™×¨×ª ×ª×©×œ×•× ×—×“×©)**
```typescript
// Request
{
  TerminalNumber: string;
  UserName: string;
  APIKey: string;
  Operation: 1; // 1 = ×—×™×•×‘, 2 = ×–×™×›×•×™
  Currency: 1; // 1 = ×©×§×œ
  Sum: number;
  Description: string;
  ReturnValue: string; // ××–×”×” ×”×–×× ×”
  SuccessRedirectUrl: string;
  ErrorRedirectUrl: string;
  CreateToken: boolean;
}

// Response
{
  ResponseCode: number; // 0 = ×”×¦×œ×—×”
  url: string; // URL ×œ×“×£ ×”×ª×©×œ×•×
  Description: string; // ×ª×™××•×¨ ×”×ª×•×¦××”
}
```

**Charge (×—×™×•×‘ ×™×©×™×¨ ×¢× ×˜×•×§×Ÿ)**
```typescript
// Request
{
  TerminalNumber: string;
  UserName: string;
  APIKey: string;
  Operation: 1;
  Currency: 1;
  Sum: number;
  Description: string;
  Token: string;
  ReturnValue: string;
}

// Response
{
  ResponseCode: number;
  TransactionId: string;
  Description: string;
}
```

2. **Next.js Implementation**

Here's how to implement this in Next.js:

First, create a CARDCOM service:

```typescript
// services/cardcom.ts
export class CardComService {
  private terminalNumber: string;
  private userName: string;
  private apiKey: string;
  private baseUrl: string;

  constructor() {
    this.terminalNumber = process.env.CARDCOM_TERMINAL!;
    this.userName = process.env.CARDCOM_USERNAME!;
    this.apiKey = process.env.CARDCOM_API_KEY!;
    this.baseUrl = 'https://secure.cardcom.solutions/api/v11/';
  }

  async createPayment(data: {
    amount: number;
    description: string;
    orderId: string;
    successUrl: string;
    errorUrl: string;
  }) {
    const payload = {
      TerminalNumber: this.terminalNumber,
      UserName: this.userName,
      APIKey: this.apiKey,
      Operation: 1,
      Currency: 1,
      Sum: data.amount,
      Description: data.description,
      ReturnValue: data.orderId,
      SuccessRedirectUrl: data.successUrl,
      ErrorRedirectUrl: data.errorUrl,
      CreateToken: true
    };

    const response = await fetch(`${this.baseUrl}LowProfile`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    return response.json();
  }

  async chargeToken(data: {
    amount: number;
    description: string;
    token: string;
    orderId: string;
  }) {
    const payload = {
      TerminalNumber: this.terminalNumber,
      UserName: this.userName,
      APIKey: this.apiKey,
      Operation: 1,
      Currency: 1,
      Sum: data.amount,
      Description: data.description,
      Token: data.token,
      ReturnValue: data.orderId
    };

    const response = await fetch(`${this.baseUrl}Charge`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    return response.json();
  }
}
```

3. **API Routes**

```typescript
// app/api/payments/create/route.ts
import { CardComService } from '@/services/cardcom';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { amount, description, orderId } = await req.json();
    
    const cardcom = new CardComService();
    const result = await cardcom.createPayment({
      amount,
      description,
      orderId,
      successUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/success`,
      errorUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/error`
    });

    if (result.ResponseCode === 0) {
      return NextResponse.json({ url: result.url });
    } else {
      return NextResponse.json(
        { error: result.Description },
        { status: 400 }
      );
    }
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to create payment' },
      { status: 500 }
    );
  }
}

// app/api/payments/charge/route.ts
import { CardComService } from '@/services/cardcom';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { amount, description, token, orderId } = await req.json();
    
    const cardcom = new CardComService();
    const result = await cardcom.chargeToken({
      amount,
      description,
      token,
      orderId
    });

    if (result.ResponseCode === 0) {
      return NextResponse.json({ 
        success: true,
        transactionId: result.TransactionId 
      });
    } else {
      return NextResponse.json(
        { error: result.Description },
        { status: 400 }
      );
    }
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to process payment' },
      { status: 500 }
    );
  }
}
```

4. **React Components**

```typescript
// components/PaymentForm.tsx
'use client';

import { useState } from 'react';

export function PaymentForm({ orderId, amount }: { orderId: string; amount: number }) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handlePayment = async () => {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch('/api/payments/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount,
          description: `×”×–×× ×” ××¡×¤×¨ ${orderId}`,
          orderId,
        }),
      });

      const data = await response.json();

      if (data.error) {
        setError(data.error);
      } else {
        window.location.href = data.url;
      }
    } catch (err) {
      setError('×©×’×™××” ×‘×ª×”×œ×™×š ×”×ª×©×œ×•×');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="payment-form">
      <h2>×ª×©×œ×•×</h2>
      <p>×¡×›×•× ×œ×ª×©×œ×•×: â‚ª{amount}</p>
      {error && <div className="error">{error}</div>}
      <button 
        onClick={handlePayment}
        disabled={loading}
      >
        {loading ? '××¢×‘×“...' : '×œ×ª×©×œ×•×'}
      </button>
    </div>
  );
}

// components/ManualCharge.tsx
'use client';

import { useState } from 'react';

export function ManualCharge({ token }: { token: string }) {
  const [amount, setAmount] = useState('');
  const [description, setDescription] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  const handleCharge = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      setLoading(true);
      setError(null);
      setSuccess(false);

      const response = await fetch('/api/payments/charge', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount: parseFloat(amount),
          description,
          token,
          orderId: `MANUAL_${Date.now()}`,
        }),
      });

      const data = await response.json();

      if (data.error) {
        setError(data.error);
      } else {
        setSuccess(true);
        setAmount('');
        setDescription('');
      }
    } catch (err) {
      setError('×©×’×™××” ×‘×ª×”×œ×™×š ×”×—×™×•×‘');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleCharge} className="manual-charge">
      <h2>×—×™×•×‘ ×™×“× ×™</h2>
      <div>
        <label>
          ×¡×›×•×:
          <input
            type="number"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            required
            min="0"
            step="0.01"
          />
        </label>
      </div>
      <div>
        <label>
          ×ª×™××•×¨:
          <input
            type="text"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            required
          />
        </label>
      </div>
      {error && <div className="error">{error}</div>}
      {success && <div className="success">×”×—×™×•×‘ ×‘×•×¦×¢ ×‘×”×¦×œ×—×”!</div>}
      <button type="submit" disabled={loading}>
        {loading ? '××¢×‘×“...' : '×‘×¦×¢ ×—×™×•×‘'}
      </button>
    </form>
  );
}
```

5. **Environment Variables**

Create a `.env.local` file:

```env
CARDCOM_TERMINAL=your_terminal_number
CARDCOM_USERNAME=your_username
CARDCOM_API_KEY=your_api_key
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

6. **Database Schema**

```sql
CREATE TABLE orders (
  id VARCHAR(255) PRIMARY KEY,
  customerName VARCHAR(255),
  customerEmail VARCHAR(255),
  customerPhone VARCHAR(20),
  price DECIMAL(10,2),
  status ENUM('pending', 'processing', 'completed', 'cancelled', 'refunded', 'failed') DEFAULT 'pending',
  cc_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE payments (
  id VARCHAR(255) PRIMARY KEY,
  order_id VARCHAR(255),
  type ENUM('ccard', 'refund', 'cash') DEFAULT 'ccard',
  sub_type ENUM('direct', 'token', 'manual') DEFAULT 'direct',
  amount DECIMAL(10,2),
  status ENUM('pending', 'completed', 'failed') DEFAULT 'pending',
  token VARCHAR(255),
  transaction_id VARCHAR(255),
  input_data JSON,
  result_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (order_id) REFERENCES orders(id)
);
```

Regarding your specific questions:

1. **××¡×¤×¨ ×¢×¡×§×” (Transaction ID)**: ×›×Ÿ, CARDCOM ××—×–×™×¨ ××¡×¤×¨ ×¢×¡×§×” ×™×™×—×•×“×™ ×‘×›×œ ×¤×¢×•×œ×” ××•×¦×œ×—×ª. ×”××¡×¤×¨ ×”×–×” × ×©××¨ ×‘×˜×‘×œ×ª ×”×ª×©×œ×•××™× ×•××©××© ×œ×–×™×”×•×™ ×”×¢×¡×§×”.

2. **×‘×§×©×•×ª ×•×ª×’×•×‘×•×ª ×‘-API**:
   - **LowProfile (×™×¦×™×¨×ª ×ª×©×œ×•× ×—×“×©)**:
     - ×‘×§×©×”: ×¤×¨×˜×™ ×˜×¨××™× ×œ, ×¡×›×•×, ×ª×™××•×¨, ×›×ª×•×‘×•×ª ×”×¤× ×™×”
     - ×ª×’×•×‘×”: URL ×œ×“×£ ×ª×©×œ×•×, ×§×•×“ ×ª×’×•×‘×”, ×ª×™××•×¨
   
   - **Charge (×—×™×•×‘ ×™×©×™×¨)**:
     - ×‘×§×©×”: ×¤×¨×˜×™ ×˜×¨××™× ×œ, ×˜×•×§×Ÿ, ×¡×›×•×, ×ª×™××•×¨
     - ×ª×’×•×‘×”: ××¡×¤×¨ ×¢×¡×§×”, ×§×•×“ ×ª×’×•×‘×”, ×ª×™××•×¨

3. **×§×•××¤×•× × ×˜×•×ª**:
   - `PaymentForm`: ×§×•××¤×•× × ×˜×” ×œ×—×™×•×‘ ××•×˜×•××˜×™ ×‘×”×–×× ×•×ª
   - `ManualCharge`: ×§×•××¤×•× × ×˜×” ×œ×—×™×•×‘/×–×™×›×•×™ ×™×“× ×™

×”×§×•×“ ×”×–×” ××¡×¤×§ ×¤×ª×¨×•×Ÿ ××œ× ×•××•×“×¨× ×™ ×‘-Next.js, ×¢×:
- ×˜×™×¤×•×œ ×‘×©×’×™××•×ª
- × ×™×”×•×œ ××¦×‘ ×˜×¢×™× ×”
- ××‘×˜×—×” (HTTPS, ×•×•×œ×™×“×¦×™×”)
- ×××©×§ ××©×ª××© × ×•×—
- ×©××™×¨×ª ×”×™×¡×˜×•×¨×™×™×ª ×ª×©×œ×•××™×
- ×ª××™×›×” ×‘×—×™×•×‘×™× ××•×˜×•××˜×™×™× ×•×™×“× ×™×™×

```typescript
// Request
{
  TerminalNumber: string;
  UserName: string;
  APIKey: string;
  Operation: 1; // 1 = ×—×™×•×‘, 2 = ×–×™×›×•×™
  Currency: 1; // 1 = ×©×§×œ
  Sum: number;
  Description: string;
  ReturnValue: string; // ××–×”×” ×”×–×× ×”
  SuccessRedirectUrl: string;
  ErrorRedirectUrl: string;
  CreateToken: boolean;
}

// Response
{
  ResponseCode: number; // 0 = ×”×¦×œ×—×”
  url: string; // URL ×œ×“×£ ×”×ª×©×œ×•×
  Description: string; // ×ª×™××•×¨ ×”×ª×•×¦××”
}
```

```typescript
// Request
{
  TerminalNumber: string;
  UserName: string;
  APIKey: string;
  Operation: 1;
  Currency: 1;
  Sum: number;
  Description: string;
  Token: string;
  ReturnValue: string;
}

// Response
{
  ResponseCode: number;
  TransactionId: string;
  Description: string;
}
```

```typescript
// services/cardcom.ts
export class CardComService {
  private terminalNumber: string;
  private userName: string;
  private apiKey: string;
  private baseUrl: string;

  constructor() {
    this.terminalNumber = process.env.CARDCOM_TERMINAL!;
    this.userName = process.env.CARDCOM_USERNAME!;
    this.apiKey = process.env.CARDCOM_API_KEY!;
    this.baseUrl = 'https://secure.cardcom.solutions/api/v11/';
  }

  async createPayment(data: {
    amount: number;
    description: string;
    orderId: string;
    successUrl: string;
    errorUrl: string;
  }) {
    const payload = {
      TerminalNumber: this.terminalNumber,
      UserName: this.userName,
      APIKey: this.apiKey,
      Operation: 1,
      Currency: 1,
      Sum: data.amount,
      Description: data.description,
      ReturnValue: data.orderId,
      SuccessRedirectUrl: data.successUrl,
      ErrorRedirectUrl: data.errorUrl,
      CreateToken: true
    };

    const response = await fetch(`${this.baseUrl}LowProfile`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    return response.json();
  }

  async chargeToken(data: {
    amount: number;
    description: string;
    token: string;
    orderId: string;
  }) {
    const payload = {
      TerminalNumber: this.terminalNumber,
      UserName: this.userName,
      APIKey: this.apiKey,
      Operation: 1,
      Currency: 1,
      Sum: data.amount,
      Description: data.description,
      Token: data.token,
      ReturnValue: data.orderId
    };

    const response = await fetch(`${this.baseUrl}Charge`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(payload),
    });

    return response.json();
  }
}
```

```typescript
// app/api/payments/create/route.ts
import { CardComService } from '@/services/cardcom';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { amount, description, orderId } = await req.json();
    
    const cardcom = new CardComService();
    const result = await cardcom.createPayment({
      amount,
      description,
      orderId,
      successUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/success`,
      errorUrl: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/error`
    });

    if (result.ResponseCode === 0) {
      return NextResponse.json({ url: result.url });
    } else {
      return NextResponse.json(
        { error: result.Description },
        { status: 400 }
      );
    }
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to create payment' },
      { status: 500 }
    );
  }
}

// app/api/payments/charge/route.ts
import { CardComService } from '@/services/cardcom';
import { NextResponse } from 'next/server';

export async function POST(req: Request) {
  try {
    const { amount, description, token, orderId } = await req.json();
    
    const cardcom = new CardComService();
    const result = await cardcom.chargeToken({
      amount,
      description,
      token,
      orderId
    });

    if (result.ResponseCode === 0) {
      return NextResponse.json({ 
        success: true,
        transactionId: result.TransactionId 
      });
    } else {
      return NextResponse.json(
        { error: result.Description },
        { status: 400 }
      );
    }
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to process payment' },
      { status: 500 }
    );
  }
}
```

```typescript
// components/PaymentForm.tsx
'use client';

import { useState } from 'react';

export function PaymentForm({ orderId, amount }: { orderId: string; amount: number }) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handlePayment = async () => {
    try {
      setLoading(true);
      setError(null);

      const response = await fetch('/api/payments/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount,
          description: `×”×–×× ×” ××¡×¤×¨ ${orderId}`,
          orderId,
        }),
      });

      const data = await response.json();

      if (data.error) {
        setError(data.error);
      } else {
        window.location.href = data.url;
      }
    } catch (err) {
      setError('×©×’×™××” ×‘×ª×”×œ×™×š ×”×ª×©×œ×•×');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="payment-form">
      <h2>×ª×©×œ×•×</h2>
      <p>×¡×›×•× ×œ×ª×©×œ×•×: â‚ª{amount}</p>
      {error && <div className="error">{error}</div>}
      <button 
        onClick={handlePayment}
        disabled={loading}
      >
        {loading ? '××¢×‘×“...' : '×œ×ª×©×œ×•×'}
      </button>
    </div>
  );
}

// components/ManualCharge.tsx
'use client';

import { useState } from 'react';

export function ManualCharge({ token }: { token: string }) {
  const [amount, setAmount] = useState('');
  const [description, setDescription] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [success, setSuccess] = useState(false);

  const handleCharge = async (e: React.FormEvent) => {
    e.preventDefault();
    try {
      setLoading(true);
      setError(null);
      setSuccess(false);

      const response = await fetch('/api/payments/charge', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount: parseFloat(amount),
          description,
          token,
          orderId: `MANUAL_${Date.now()}`,
        }),
      });

      const data = await response.json();

      if (data.error) {
        setError(data.error);
      } else {
        setSuccess(true);
        setAmount('');
        setDescription('');
      }
    } catch (err) {
      setError('×©×’×™××” ×‘×ª×”×œ×™×š ×”×—×™×•×‘');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleCharge} className="manual-charge">
      <h2>×—×™×•×‘ ×™×“× ×™</h2>
      <div>
        <label>
          ×¡×›×•×:
          <input
            type="number"
            value={amount}
            onChange={(e) => setAmount(e.target.value)}
            required
            min="0"
            step="0.01"
          />
        </label>
      </div>
      <div>
        <label>
          ×ª×™××•×¨:
          <input
            type="text"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            required
          />
        </label>
      </div>
      {error && <div className="error">{error}</div>}
      {success && <div className="success">×”×—×™×•×‘ ×‘×•×¦×¢ ×‘×”×¦×œ×—×”!</div>}
      <button type="submit" disabled={loading}>
        {loading ? '××¢×‘×“...' : '×‘×¦×¢ ×—×™×•×‘'}
      </button>
    </form>
  );
}
```

```plaintext
CARDCOM_TERMINAL=your_terminal_number
CARDCOM_USERNAME=your_username
CARDCOM_API_KEY=your_api_key
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

```sql
CREATE TABLE orders (
  id VARCHAR(255) PRIMARY KEY,
  customerName VARCHAR(255),
  customerEmail VARCHAR(255),
  customerPhone VARCHAR(20),
  price DECIMAL(10,2),
  status ENUM('pending', 'processing', 'completed', 'cancelled', 'refunded', 'failed') DEFAULT 'pending',
  cc_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE payments (
  id VARCHAR(255) PRIMARY KEY,
  order_id VARCHAR(255),
  type ENUM('ccard', 'refund', 'cash') DEFAULT 'ccard',
  sub_type ENUM('direct', 'token', 'manual') DEFAULT 'direct',
  amount DECIMAL(10,2),
  status ENUM('pending', 'completed', 'failed') DEFAULT 'pending',
  token VARCHAR(255),
  transaction_id VARCHAR(255),
  input_data JSON,
  result_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (order_id) REFERENCES orders(id)
);
```

